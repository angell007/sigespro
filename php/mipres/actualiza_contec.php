<?php
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Headers: Origin, Content-Type, X-Auth-Token');

include_once('../../class/class.complex.php');
include_once('../../class/class.consulta.php');

//include_once('../../class/class.querybasedatos.php');
//include_once('../../class/class.http_response.php');
//require_once('../../class/class.configuracion.php');
include_once('../../class/class.mipres.php');

ini_set("memory_limit","32000M");
ini_set('max_execution_time', 0);


$mipres= new Mipres();

$query = '
            SELECT NoPrescripcion , GROUP_CONCAT(ID)
            FROM Producto_Dispensacion_Mipres 
            WHERE ConTec IS NULL AND NoPrescripcion IS NOT NULL AND  NoPrescripcion != ""  AND ID IS NOT NULL
            GROUP BY NoPrescripcion
            #LIMIT 10
            ';

$oCon = new consulta();
$oCon->setTipo('Multiple');
$oCon->setQuery($query);
$productos = $oCon->getData();
unset($oCon);
echo '<pre>';
/*
var_dump($productos);

*/


//$productos = getCods();

foreach ($productos as $key => $prod) {
    
   // var_dump($prod['NoPrescripcion']);
    ///exit;
      $respuesta=$mipres->GetDireccionamientoPorPrescripcion($prod['NoPrescripcion']);
    //var_dump(['res',$respuesta]);
   // exit;
   
     
     foreach($respuesta as $k => $res){
        $query = '
            UPDATE Producto_Dispensacion_Mipres
            SET ConTec = '.$res['ConTec'].'
            WHERE ID = '.$res['ID'];
        $oCon = new consulta();
       $oCon->setQuery($query);
        $pr = $oCon->createData();
        unset($oCon);
        echo '<pre>';
        var_dump($query);
         
     }
    
     var_dump(['res',$respuesta]);
    

   // var_dump($prod);
    # code...
   /* $query = 'SELECT * FROM Producto_Dispensacion_Mipres WHERE Id_Producto_Dispensacion_Mipres = '.$prod;
    $oCon = new consulta();
    
    $oCon->setQuery($query);
    $dispensacion = $oCon->getData();
    unset($oCon);
    
    print_r($dispensacion);*/
    
    
    
    

/*


    $query = 'SELECT Id_Dispensacion_Mipres, '.$dispensacion['Id_Dispensacion'].' "Id_Dispensacion" ,
        SUM(IFNULL(IdProgramacion,0)) AS IdProgramacion,
        SUM(IFNULL(IdEntrega,0)) AS IdEntrega,
        SUM(IFNULL(IdReporteEntrega,0)) AS IdReporteEntrega
    FROM Producto_Dispensacion_Mipres
     WHERE Id_Dispensacion_Mipres = '.$dispensacionM['Id_Dispensacion_Mipres'];
    $oCon = new consulta();
    $oCon->setQuery($query);
    $producto = $oCon->getData();
    unset($oCon);*/


}

function getCods(){
    return 
    [
  "20190912171014343087",
"20190918143014466540",
"20190918163014461269",
"20190729148013454701",
"20190801290000743263",
"20190801163013515574",
"20190731120013497424",
"20191114136015584863",
"20191029170015269519",
"20191002250000826907",
"20190920162014507866",
"20190803116013559821",
"20191002244000827899",
"20191010173014905519",
"20191017175015029573",
"20191018114015066864",
"20190920196014516013",
"20190927236000821578",
"20190917160014421799",
"20190924190014570704",
"20190906173014228416",
"20190919130014490278",
"20190918163014456605",
"20190923197014555461",
"20190925136014608889",
"20190528153012266553",
"20190829285000780879",
"20190829296000781123",
"20191004118014800564",
"20191120190015716737",
"20191128178015905524",
"20191007196014842631",
"20191008224000835160",
"20191009110014894896",
"20191009116014874188",
"20191129194015926032",
"20191026112015226270",
"20190716118013198129",
"20190722117013296646",
"20190813147013742388",
"20190812187013714431",
"20190808153013654300",
"20190927176014652599",
"20190916121014415282",
"20191003271000829794",
"20190930127014701043",
"20190704273000689946",
"20190924149014561351",
"20191206149016083807",
"20190822126013902748",
"20190830133014089945",
"20190902133014129857",
"20190902192014129550",
"20191010192014927661",
"20190808185013628534",
"20190805159013588252",
"20190910127014277683",
"20190923103014541542",
"20191022152015137863",
"20191026129015224684",
"20191010193014919027",
"20191025197015203359",
"20190802113013535177",
"20190806161013603873",
"20190806137013616565",
"20191023146015150750",
"20191024243000854642",
"20191023246000852551",
"20190930195014691927",
"20190909118014246714",
"20190913248000801141",
"20191018137015073181",
"20191029251000859953",
"20191024145015176702",
"20191015139014982567",
"20191021111015093352",
"20191021250000849043",
"20191015117014977343",
"20191020163015086323",
"20191001163014728000",
"20190902162014129592",
"20190826100013985847",
"20190909254000795018",
"20190829127014059738",
"20190829135014069071",
"20190829155014069077",
"20190829183014059815",
"20190831191014092656",
"20190919113014490746",
"20190919168014497274",
"20190919139014489181",
"20190920131014516450",
"20190618166012673190",
"20190922137014533032",
"20190725225000732047",
"20190816172013822418",
"20190816160013822737",
"20190818116013834308",
"20190817180013831449",
"20190814140013753398",
"20190907192014235664",
"20190721103013284205",
"20190722280000721565",
"20190905118014191798",
"20190824168013954736",
"20190916137014402913",
"20190831117014099947",
"20190916288000804768",
"20190916290000804710",
"20190917278000806258",
"20190917130014437059",
"20190917193014435418",
"20190729214000738788",
"20190917178014436986",
"20190920169014514769",
"20190907136014236617",
"20190909155014247757",
"20190911152014306187",
"20190925191014603244",
"20190909165014255188",
"20190612296000665419",
"20190817140013827290",
"20190930148014701030",
"20190802142013548923",
"20190801194013527195",
"20190801172013529455",
"20190806181013620006",
"20190802170013557994",
"20191008194014850183",
"20190916154014415105",
"20190721173013284060",
"20190705176012967152",
"20190717132013205323",
"20190719136013277583",
"20190724135013354394",
"20190719170013278120",
"20190726130013396359",
"20190724127013351619",
"20190830156014091914",
"20191003124014773891",
"20190429174011671109",
"20190901130014102960",
"20190821123013889621",
"20190816175013823767",
"20190910263000796935",
"20190806140013613562",
"20190806197013613463",
"20190805185013586722",
"20190718197013247700",
"20190621113012748738",
"20190612160012556731",
"20190628157012872871",
"20190628157012863061",
"20190926167014619876",
"20190726170013411115",
"20190617158012627490",
"20190902188014114411",
"20190723195013316665",
"20190723118013317202",
"20190621118012749442",
"20190624134012768890",
"20190626137012799312",
"20190625127012794788",
"20190919213000809996",
"20190924203000816150",
"20190809178013675934",
"20190831137014099991",
"20190624150012768852",
"20190914120014384888",
"20190823143013943429",
"20190709153013033083",
"20190823147013944847",
"20190606138012435606",
"20190828180014041629",
"20190919137014485260",
"20190917160014427838",
"20190913125014370741",
"20190830114014079688",
"20190827177013998591",
"20190614262000669105",
"20191011241000839565",
"20190517260000623742",
"20190801216000743358",
"20190711282000699803",
"20190708248000694356",
"20190927243000821729",
"20190708263000694345",
"20191018250000846602",
"20190916217000804625"

    ];
}

                
                
                
?>