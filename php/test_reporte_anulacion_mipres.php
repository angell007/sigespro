<?php
ini_set("memory_limit","32000M");
ini_set('max_execution_time', 0);

header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Headers: Origin, Content-Type, X-Auth-Token');
//header('Content-Type: application/json');

include_once('../class/class.querybasedatos.php');
include_once('../class/class.http_response.php');
include_once('../class/class.mipres.php');
include_once('../class/class.php_mailer.php');

$queryObj = new QueryBaseDatos();

$mipres= new Mipres();
    
    
    
$query="
SELECT PDM.Id_Producto_Dispensacion_Mipres, PDM.NoPrescripcion, PDM.ID, PDM.Codigo_Cum, PDM.Cantidad, PDM.IdProgramacion, PDM.IdEntrega, PDM.IdReporteEntrega, PDM.Valor_Reportado,
#ERP.Id_Tipo, ERP.Fecha_Reporte, ERP.Cantidad_Reportada, ERP.Cum_Reportado, ERP.Valor_Reportado,
PDM.Anulado, PDM.Actualizado, PDM.Anulado, PDM.Actualizado2, PDM.Anulado3, PDM.Actualizado3
FROM Producto_Dispensacion_Mipres PDM 
INNER JOIN Dispensacion_Mipres DM ON DM.Id_Dispensacion_Mipres = PDM.Id_Dispensacion_Mipres
#INNER JOIN Z_Estado_Reporte_Mipres ERP ON ERP.ID = PDM.ID AND ERP.Tipo = 'ReporteEntrega' AND ERP.Estado_Reporte != 0

WHERE PDM.IdReporteEntrega IN (18436830,
20966953,
20968100,
20968439,
20968866,
20968441,
20968447,
20967063,
18444709,
20966388,
20968877,
20968443,
20966969,
20968129,
20968115,
20966971,
20967310,
20965782,
20965802,
20966954,
20968008,
20968084,
20967151,
20967384,
18448707,
20968112,
18449126,
20967795,
18442309,
18442309,
20968118,
20272825,
20968889,
20967740,
20967926,
20272717,
20272831,
20967856,
20967849,
20968874,
20967862,
20967862,
20968858,
20967975,
20967011,
20967055,
20967156,
20967698,
18433461,
20967666,
20967866,
20967386,
20967920,
20967329,
20967388,
20965964,
20967320,
20968419,
20966501,
20968861,
20968209,
20966148,
18435739,
20966148,
18442681,
18442681,
20967169,
20971644,
18441722,
18442059,
15182910,
18433598,
20967087,
20967868,
20967949,
20967949,
20968130,
20967937,
18439642,
18439972,
18433934,
20967656,
18437785,
20966904,
18434299,
20968666,
20966625,
20966694,
18444724,
20967514,
20967863,
20967873,
20967763,
20966834,
20966004,
20968869,
20968850,
18434825,
18434825,
18434747,
20966126,
20972208,
20966710,
20966540,
20967705,
18435539,
18437183,
10770483,
20971907,
20966436,
20966249,
20968828,
18449584,
18449584,
20966565,
20965857,
18440052,
10768430,
20968024,
20966696,
12885914,
20965990,
20966177,
20966198,
20966243,
20967401,
18436681,
18436681,
20966167,
18447955,
18447955,
18439673,
11260323,
20967745,
20971945,
18435784,
20733861,
20965957,
20966194,
20725494,
18448676,
20967639,
20968011,
18438924,
20966615,
15173011,
21153361,
20968371,
20967943,
20967123,
18445683,
20966387,
20965912,
20967780,
13482725,
18440425,
20272771,
20967093,
18436055,
20968621,
20965811,
20968170,
20967353,
20972212,
18445441,
18445441,
18445441,
20967427,
13482138,
18440719,
13482632,
13483176,
20967953,
20966874,
18433891,
20724747,
20724747,
18440660,
18440660,
20967109,
20966273,
10767463,
20968123,
20967875,
20967951,
20966180,
20968697,
18434475,
18434397,
18438064,
18438064,
20967458,
20967452,
10767467,
10767504,
10767515,
10767524,
10767533,
10767541,
10767544,
20967376,
20967373,
20967380,
20967378,
20967381,
10767559,
10767568,
10767575,
14977997,
20968014,
20971648,
19540634,
18433605,
10767602,
10767608,
10767609,
13483574,
13481326,
13481383,
15172831,
15172831,
13481979,
10767654,
13481917,
10767676,
13483920,
14621170,
20966683,
10767684,
14620767,
14620767,
10767689,
10767710,
10767721,
10767724,
20966686,
14621161,
14621611,
14621607,
10768046,
10768047,
13481882,
10767757,
10767756,
13484045,
13484045,
13484723,
13484722,
13482458,
10767778,
10767779,
10767789,
10767791,
10767791,
14621883,
14621592,
14622042,
14620850,
10767868,
18437442,
20967329,
20967116,
14621125,
20966992,
20968817,
18443319,
18443319,
18443319,
20965886,
20965819,
18433907,
20968133,
20972216,
20966098,
10767902,
13483392,
10767918,
10767915,
13483395,
10767920,
13484615,
20966687,
20968435,
10767970,
20966909,
18439086,
20965751,
10767972,
13958486,
18438566,
20967357,
20967112,
20966803,
10768012,
10768021,
10768022,
13483968,
10768025,
10767748,
10768047,
10768047,
10768069,
10768085,
20966870,
10768107,
20966811,
14621080,
14620848,
10768187,
10768199,
10768200,
13481802,
14978012,
13482684,
14621730,
14621984,
14621997,
14621259,
14621892,
14977962,
14621029,
14621526,
14621601,
13482199,
20966788,
10768337,
20966430,
12844995,
20972180,
18440578,
20967350,
20967829,
13482835,
13482829,
10768415,
20967365,
20967364,
14620678,
10768431,
10768743,
10768747,
14621642,
14621642,
13482387,
13484365,
13484089,
13484338,
21153102,
14621039,
14621483,
13482686,
10768832,
10768850,
13485694,
14057704,
14057629,
10768880,
10768881,
10768882,
9910356,
9910357,
13483408,
20965609,
14057624,
14621974,
20965523,
13482813,
13485346,
13483903,
14620668,
10769070,
13485950,
20725242,
18442452,
10769123,
10769124,
10769128,
20966731,
13483116,
13484213,
10769152,
10769151,
10769153,
10769153,
10769154,
10769180,
10769197,
10769249,
14620851,
14621761,
14622111,
14621420,
13482645,
10769425,
14621530,
14978019,
14621486,
21153330,
21153330,
14620724,
14620724,
14621144,
14620649,
14622036,
10769928,
14620744,
13977676,
13482850,
13483111,
10770025,
10770050,
10770073,
14621263,
10770296,
10770310,
10770320,
10770323,
10770346,
13481335,
20724867,
20724867,
18435042,
20968028,
10767496,
10770489,
10770500,
10770513,
10770516,
14620738,
10770547,
10770567,
10770567,
10771923,
10771986,
10772033,
13977204,
13485592,
10775080,
13484391,
10779176,
10779176,
13483193,
10779622,
10779786,
13481341,
14621453,
13976510,
10784072,
13958619,
10849981,
10850051,
10850095,
20966903,
13483818,
13483511,
10854274,
14621418,
10860541,
10861280,
10862301,
10862300,
10862414,
10862488,
10862654,
10862676,
13483126,
10910696,
10914018,
10914021,
10920848,
13485807,
13485807,
20972089,
13481329,
18448704,
18448704,
20972074,
14621162,
11036018,
11036069,
11036087,
13977346,
20966404,
20966312,
11076505,
13976465,
12883101,
13977065,
11201683,
11201895,
13977644,
13977644,
11205153,
11206306,
11207556,
21153367,
11256747,
20966079,
11259041,
11259327,
11259355,
11260323,
11260969,
13484389,
11261973,
11262475,
11270923,
11295803,
11306820,
18433388,
13977439,
13481495,
13481495,
20967974,
12883606,
21153137,
14620611,
12883621,
12883712,
13482100,
13482105,
12883755,
12883757,
12883758,
14621296,
13977256,
12884066,
18445288,
13978281,
21153305,
13947599,
13961585,
13482347,
13778968,
13481430,
13485350,
13485350,
13923164,
11987403,
13976326,
13485888,
13977414,
21153102,
13484490,
13483207,
13483207,
13975728,
14622080,
13959164,
15173368,
13485639,
13976774,
13976774,
14620713,
13977351,
14621177,
14621177,
20967939,
13481296,
18436265,
18444889,
18444888,
20965742,
13486096,
12153122,
12153123,
20966725,
14622081,
21153037,
13977091,
13977091,
13977091,
13976031,
13976023,
13975949,
13975602,
13975602,
13976823,
13977253,
12884948,
12884950,
13975875,
13978213,
13976378,
13978174,
21153055,
21153056,
13977576,
13978233,
13975604,
13958817,
13958812,
18434219,
18434215,
12885220,
12885255,
13481835,
13484799,
12417236,
12885494,
12885510,
14620793,
14621294,
14621293,
14620854,
13978168,
14622086,
13977587,
12423039,
13960072,
12460285,
12460285,
13976746,
13976739,
13975957,
13976552,
13975622,
13976367,
13975968,
12885721,
13977614,
13977614,
15172888,
19539883,
12885736,
12550907,
13978228,
14621879,
14621329,
13978138,
14620674,
13482578,
14621313,
20966585,
14621565,
14621800,
14978008,
14621228,
14622163,
14620861,
14620637,
21153466,
14621547,
14621996,
14620529,
14622160,
14622069,
18440272,
12712500,
13975764,
13977502,
13485142,
13976346,
13483920,
15172817,
15181515,
13482664,
13482663,
13482875,
13481400,
13481978,
13482665,
13482975,
13482508,
13485886,
14620778,
13482851,
13481851,
13485724,
13484270,
13484861,
13482127,
13483153,
13485494,
13485283,
13481367,
13481312,
13484793,
13485217,
13485495,
12840411,
20967551,
12843654,
12844995,
14621999,
13482358,
14620765,
14620978,
14621606,
21153212,
14621536,
20968134,
13481738,
13482801,
13482839,
13482369,
13482251,
13482251,
20966964,
13482357,
20967028,
18448545,
20966990,
20966994,
20272988,
20272798,
13484870,
12881261,
21153544,
21153446,
20966946,
13975646,
13975782,
13977375,
13977368,
13977367,
20967059,
13977217,
13978008,
13978008,
14622171,
13485659,
14620834,
14620834,
20965768,
21153473,
14622200,
21153489,
21153036,
21153266,
14622147,
14622179,
14621911,
14621755,
13486154,
12987912,
14620468,
13482097,
13483030,
14621952,
14620495,
14620951,
13482713,
13481717,
14977954,
13483579,
12994097,
21153025,
13481965,
13482033,
13481288,
13484447,
13485533,
13484129,
13485853,
21153325,
21153326,
21153328,
21153327,
13483704,
13482182,
12996850,
13485352,
13486313,
13486343,
20967567,
13484280,
13482349,
13481709,
14622193,
14622148,
12701970,
13481244,
13483017,
13481886,
13482368,
13482828,
13484033,
13485808,
13485808,
13485163,
13482827,
13484076,
21153070,
21153074,
13482350,
15173268,
13482811,
13486083,
13483922,
21153334,
21153333,
14620478,
21153658,
14620787,
21153388,
14620718,
13483442,
14621829,
14621284,
21153400,
13485890,
21153267,
14622089,
14621245,
21153399,
21153508,
21153164,
13484124,
13484145,
13481783,
14621448,
14621929,
14620537,
14621427,
21153078,
13482394,
14621784,
14622017,
13482891,
13486230,
13486230,
13068643,
13068644,
13068645,
14620622,
13069264,
13484626,
13481721,
13482181,
13482184,
14620833,
13484368,
13485661,
13976053,
14620499,
20967759,
21153339,
13482973,
13073044,
13073274,
13073274,
13073473,
13073553,
13073664,
13073668,
14621088,
13073902,
13073903,
13073925,
13074332,
14621089,
13074378,
21153222,
21153224,
21153605,
13075186,
13483418,
14621270,
14621904,
14620827,
13481246,
18436461,
13076480,
18446460,
18446479,
18446698,
18438559,
18438559,
18432929,
18435482,
15183991,
15184012,
15172883,
15172817,
15178065,
15213567,
15188908,
15184246,
15184246,
15213542,
15178077,
15186004,
15173249,
21153365,
21153365,
15173426,
15184131,
15184131,
20966967,
20966997,
15176625,
15176625,
15211930,
15209967,
15182855,
20966334,
15170969,
15170969,
15183735,
15170233,
15213610,
18438457,
12153345,
15165947,
15184145,
15209896,
18434377,
15172941,
15184300,
15186246,
15174110,
15172853,
15176700,
15177324,
15177287,
15210445,
15186837,
15188066,
15172885,
15167496,
15209877,
15173435,
15173421,
15209988,
15185845,
15167619,
15184350,
15172743,
21153313,
15188840,
15165880,
15185543,
15173121,
15210442,
15183972,
15183972,
15172790,
15186934,
15174104,
15181655,
15181662,
15173150,
15173216,
15184507,
15184507,
15182068,
15172963,
15172967,
15172910,
15178118,
15183901,
15189144,
15189144,
15172887,
15172941,
15184682,
15184682,
15184562,
15173084,
15188881,
15188881,
15175534,
15211696,
15172270,
15173455,
15185251,
15185569,
15176273,
15178446,
15180097,
15188102,
15173994,
15173126,
15173128,
15214626,
15178193,
15178130,
15184558,
15166389,
15175506,
15173213,
15174870,
15173668,
15182949,
15166775,
15166595,
15168154,
15171859,
15172833,
15212584,
15210052,
15172843,
15168544,
15213345,
15213345,
15187353,
15187702,
15187259,
15185104,
15184476,
15180401,
15166708,
15187477,
15210246,
15182306,
15186028,
15186028,
15188056,
20967419,
20967415,
15169130,
15175459,
18440397,
15185280,
15173170,
15173929,
15213836,
15186068,
15186083,
15165969,
15188110,
15214200,
15172856,
15183865,
15186002,
15181480,
15213810,
15179771,
15165936,
15186071,
15186151,
15173865,
15173418,
15186391,
15174992,
15212096,
15211618,
15186959,
15165850,
15169472,
15167609,
15210737,
15182429,
15212450,
15174884,
15175026,
15182902,
15182902,
15174377,
15168006,
15212150,
15179763,
15185443,
15184408,
15212189,
15178421,
15188219,
15166111,
15170318,
15184304,
15186014,
15173345,
15172803,
15188553,
15167176,
15188203,
15186155,
15186155,
15186065,
15212715,
15182956,
21153122,
21153125,
15213585,
15186036,
15178267,
15185971,
21153080,
21153080,
15183217,
15182770,
15186123,
15209888,
15212216,
21153269,
21153104,
21153107,
15188463,
15175522,
15188817,
15172847,
15178314,
15174091,
15175322,
15173436,
21153600,
15175509,
15211778,
15212228,
15210796,
15175524,
15210902,
15175202,
15187748,
15173463,
15173461,
15212947,
15175651,
15211070,
15173223,
15188215,
15186295,
15183551,
15183697,
15181667,
15167472,
15176357,
15180408,
15172888,
15168249,
15172779,
15176844,
15173816,
15173293,
15173295,
15178092,
21153353,
15183917,
15179900,
15185030,
21153196,
21153196,
21153108,
21153105,
15210944,
15181735,
15181773,
15184085,
15178724,
15189095,
15212459,
15174450,
15188260,
15171687,
15171792,
15170780,
15185797,
15185875,
21153261,
19539826,
15180461,
15180451,
15180461,
21153142,
21153142,
15166060,
20968840,
20968839,
15181413,
15167075,
15168821,
21153362,
21153362,
15173882,
15208804,
15169213,
15173368,
15183461,
15183465,
15174590,
15176585,
15178863,
15172998,
15179710,
15179704,
15181716,
15210459,
21153159,
15185184,
15185214,
15174469,
15173079,
21153343,
18441186,
21153347,
15179074,
15212820,
15188169,
15171749,
15213790,
15214870,
20966984,
15173703,
15175182,
15175988,
15175988,
21153136,
21153136,
15213301,
15213301,
15214174,
15214174,
15171289,
15213766,
15213766,
15187006,
15168792,
15184480,
15211915,
15183486,
15183486,
15213379,
15212547,
15211779,
20967340,
15167485,
15167396,
15166850,
15212253,
15213223,
15213403,
15213406,
15188011,
15211563,
15213251,
15210412,
15212239,
15213327,
15186383,
15186329,
15209990,
15210878,
15212187,
15173056,
15182814,
15166910,
15175523,
15188336,
21153560,
21153644,
15170874,
15170874,
15173225,
15173225,
15211714,
15213594,
15211465,
15212483,
15184017,
15175859,
15212533,
15188644,
15167525,
15184263,
15188921,
15177983,
15173447,
15182320,
15175029,
15174750,
15184574,
21153652,
15212963,
15170792,
15211690,
15168174,
15186299,
15178147,
21153378,
15181587,
15184173,
15167634,
15185551,
15186980,
15175374,
15211480,
15185520,
15214387,
15214313,
15214313,
15181597,
15181762,
15172975,
18436474,
18436474,
15209884,
15209844,
15209968,
15177913,
18439697,
21153571,
15183963,
18434719,
18434616,
18438692,
18438735,
15187238,
15174095,
20966284,
15210002,
15186498,
15185965,
15210179,
15212080,
15213117,
15212569,
15213675,
15214034,
15214026,
15214023,
15184998,
15168203,
15186146,
15180011,
15174119,
20966680,
15213566,
15176873,
15167442,
15176722,
15172874,
15174644,
15211718,
15183422,
15176308,
15188144,
15212321,
15213692,
15213646,
15212410,
15211954,
15181755,
15173219,
15188730,
15183812,
20965763,
15213276,
15210463,
15211765,
15173053,
15213592,
15172768,
15211697,
15211449,
15211449,
15211777,
15186114,
15187676,
15173445,
15167895,
15213047,
15210078,
15173335,
15185972,
15186578,
15183869,
15186098,
15212182,
15173204,
15186302,
15213767,
15213434,
15214424,
15179622,
15214892,
15214895,
15212089,
15182806,
15186734,
15186570,
15188166,
15188125,
15186404,
15211630,
15212254,
15180323,
20965921,
15187689,
21153247,
21153249,
21153295,
21153296,
21153302,
15173028,
15173030,
15178812,
15213843,
15189113,
15189125,
15189129,
15172966,
15172970,
15212668,
15212670,
15173266,
15173267,
15173269,
15188106,
15173010,
15209800,
15172781,
15212076,
15211478,
15186011,
15186018,
15185857,
15182910,
15213570,
15186121,
15172866,
21153611,
21153612,
21153614,
21153611,
21153494,
21153496,
15182988,
15182984,
15172832,
21153396,
15172852,
15178281,
15178334,
15185623,
15211864,
15213938,
15213939,
18441298,
18441296,
15215006,
15210906,
15187979,
15215091,
15173229,
15212069,
15212088,
15212069,
15173521,
15173523,
21153532,
15210642,
15188844,
15211644,
15211646,
18434269,
20724794,
20724794,
18440002,
18446445,
15210047,
15179389,
15210196,
15171269,
15185360,
15213506,
18438768,
20966765,
20966765,
15166902,
15210219,
15210175,
15181190,
15181179,
15216391,
15165827,
15212347,
15185951,
15188917,
15211812,
15173127,
21153110,
15183660,
21153294,
21153300,
15185320,
15210534,
15177800,
15182980,
15173466,
15186261,
15182259,
15172991,
15178185,
15178041,
15184378,
21153566,
21153567,
15177090,
15179779,
15179779,
21153053,
15178936,
15166096,
15216288,
15216290,
15180995,
15172782,
15169538,
15169545,
15175700,
21153276,
15167485,
15173093,
15186150,
15173000,
15185808,
18443948,
15173277,
15173276,
21153449,
21153450,
21153452,
12244071,
12244071,
15214707,
15166617,
15166605,
21153482,
20966029,
20967915,
15189083,
15171262,
15172922,
15172925,
15172924,
15188865,
15214714,
15171258,
13483895,
20966127,
15186048,
15172736,
20966841,
15173288,
15213923,
15177155,
15175380,
13482663,
13482664,
15214813,
15173285,
15173283,
15185940,
15173452,
15213517,
15210691,
15177544,
15171266,
15186451,
15168126,
21153487,
15185391,
15211784,
15213387,
15214523,
15214524,
15183033,
15210114,
15177734,
15172784,
15180926,
20967309,
15172763,
21153411,
21153412,
15211628,
15169163,
15212532,
15209921,
15173073,
15211447,
15186038,
15181908,
15182819,
15182858,
15209866,
15188340,
15210107,
15172871,
15175470,
15179814,
15211634,
15211634,
15210564,
15171276,
15188622,
15185774,
15185778,
15210349,
15180713,
15210351,
15178402,
15189059,
20967674,
15213717,
15209969,
21153486,
21153486,
15174115,
15174122,
15186228,
15185946,
15186200,
18438240,
20966230,
15185601,
15186153,
15182347,
15174658,
15172923,
15184403,
15214671,
15214474,
20965829,
15177603,
15177603,
20725418,
18442190,
15173790,
15173851,
15188895,
15175281,
15173450,
15172934,
15167703,
15178289,
15214171,
15172972,
15183024,
15173005,
15213368,
15183905,
15175541,
15175844,
15173012,
15173012,
15176817,
15176829,
15186439,
15186455,
15172960,
15212224,
15174876,
15171260,
15211637,
18441280,
15181492,
15184690,
15209994,
14977985,
15173221,
15210015,
15211749,
15169866,
15181743,
15181777,
15188487,
15211712,
15211549,
20967646,
20967650,
20967644,
20966779,
15212950,
15213266,
15212025,
15182694,
15188121,
15210217,
15173175,
20967266,
15177719,
21153043,
15175733,
15175737,
20966351,
15173423,
20966853,
15212610,
15188479,
15188479,
15210465,
15175540,
15175539,
15212215,
15177879,
15177922,
20967564,
15166072,
15188027,
15172981,
21153226,
15168966,
15169053,
15167719,
15181127,
21153125,
15180154,
20965918,
15172785,
20966195,
15168809,
15173516,
15173244,
20966269,
15173643,
18438906,
20966164,
20966032,
15179363,
15179433,
15212537,
15214885,
15212454,
15181706,
15181691,
15176627,
15177134,
15215122,
15211861,
20965673,
15184452,
15172766,
20967839,
20967841,
21153348,
15210346,
20966941,
15174443,
15173179,
20967303,
20967293,
20967180,
20967348,
21153581,
15211791,
15212193,
15176410,
20966188,
20966190,
15180675,
15188576,
15216642,
15175518,
13482347,
15184673,
15182039,
15213450,
15173191,
15188483,
15188265,
15188265,
15185022,
15172794,
15215820,
15178051,
15209899,
15175475,
15185132,
15213856,
21153022,
15170831,
15209911,
15173598,
13483094,
20967653,
15213383,
15216088,
15214309,
15173231,
15173231,
15209847,
15184326,
15212472,
15215525,
15182583,
15189156,
15172780,
15185860,
15213844,
15213844,
15216652,
15173422,
15210030,
15188986,
15172818,
15210060,
15210070,
15172905,
15174837,
15181219,
15172994,
15167457,
20967400,
21153677,
21153677,
15176020,
15172806,
21153100,
15213897,
15187165,
15187165,
15177236,
15177311,
15177352,
20965931,
15173434,
15168334,
15176072,
15173168,
15210804,
15171275,
15187606,
15172974,
15176222,
21153088,
15178836,
21153655,
15174793,
15172235,
15172235,
15214777,
15185686,
15181090,
15172996,
15209952,
15178562,
15178665,
21153099,
15170997,
15169027,
15181865,
15173176,
15185085,
15185567,
21153510,
21153511,
21153512,
15172926,
15182751,
15172908,
15209858,
15212401,
15186031,
15167257,
15182716,
21153475,
15172878,
15184994,
15188372,
21153621,
15174319,
15210334,
15509402,
18436009,
15211222,
15211724,
15174059,
15184882,
15173473,
15173476,
15173473,
15173473,
15210604,
15212270,
15215249,
15172753,
15213732,
15188726,
15213723,
15213723,
15215111,
15210170,
15210171,
15215141,
15213507,
15214017,
15167409,
15182762,
15167090,
15214536,
15215151,
15216447,
21153634,
21153634,
15212714,
15212714,
15216035,
15173370,
15173371,
15211891,
15212427,
15172770,
15215919,
15185943,
15173350,
15173351,
15173357,
20966369,
15173021,
15173024,
21153543,
21153573,
21153574,
21153573,
15181463,
15214330,
15211804,
21153659,
15187943,
21153278,
21153279,
15509347,
15509350,
15509298,
15509299,
15509298,
15509801,
15509801,
15509563,
18450108,
18436460,
21153293,
21153395,
15509682,
15509598,
21153636,
21153636,
21153636,
15509781,
15509739,
15509402,
15509845,
15509321,
21153171,
21153637,
21153641,
15509374,
15509339,
15509340,
15509517,
15509506,
15509506,
15509798,
15509814,
15509320,
15509320,
15509320,
15509297,
15509297,
15509695,
15509286,
15509288,
15509607,
15509608,
20967941,
18446152,
18443053,
20725470,
20725470,
20965820,
20724623,
18433023,
20724623,
20724623,
18437371,
18437371,
15965767,
15967473,
20967261,
18438117,
18438027,
20966783,
20966759,
20972193,
15968352,
15968224,
15967204,
15967864,
21153092,
21153093,
15967706,
15969143,
15967092,
15967211,
21153597,
21153598,
21153310,
20967210,
15966802,
15966808,
15966809,
15966808,
15968216,
15967640,
15967740,
15967818,
16119139,
16119140,
18439003,
18438971,
20967199,
18432929,
16118934,
16118935,
13482251,
20965827,
20965549,
20965746,
16119296,
16119187,
16119176,
16119177,
16119244,
16119163,
16119164,
16119163,
16119233,
16119226,
16119234,
16119203,
16119315,
16119304,
21153044,
20968680,
18445383,
18445383,
19540887,
18445383,
19540887,
19540887,
20968680,
16233411,
18436572,
18436347,
20967254,
20966611,
20965623,
16711520,
16709527,
16711528,
18435378,
18435359,
16708067,
16708068,
16709501,
16709516,
16709517,
21153253,
21153253,
20967242,
21154202,
21154198,
21154200,
21154202,
21153398,
21153190,
16787005,
16787009,
16787010,
18444186,
18444194,
18444188,
18447524,
18447524,
18439400,
20724755,
20724755,
18443499,
18443490,
21153553,
18446373,
18446423,
18446373,
18446423,
18441180,
18446549,
18446833,
18446630,
18446428,
18446834,
18436607,
18442618,
18446941,
18445879,
18435298,
18435299,
18441109,
18442148,
18445887,
18435167,
18435179,
18433039,
18447169,
18447170,
18445419,
18447549,
18446566,
18447177,
18447178,
18447379,
18447022,
18445418,
18444972,
18444973,
18444975,
18446611,
18446613,
18446613,
18446489,
20966771,
18438526,
18447677,
18447347,
18447440,
18447441,
18447614,
18446767,
18446768,
18446767,
18446768,
18445722,
19175170,
19175170,
19174200,
19176012,
20967251,
20967247,
21153363,
20966500,
19176141,
20972214,
20967964,
19541165)
AND PDM.Anulado3 IS NULL
#LIMIT 1000
"; 
$oCon = new consulta();
$oCon->setQuery($query);
$oCon->setTipo("Multiple");
$direccionamientos = $oCon->getData();
unset($oCon);
    


$i=0;    
echo "<table border='1' cellspacing='1' cellpadding='1'><tr><td>#</td><td>Prescripcion</td><td>ID</td><td>Prod Dis Mipres</td><td>Valor Reportado</td><td>Valor Real</td><td>Anulado</td><td>Actualizado</td></tr>";
foreach($direccionamientos as $dir){ $i++;
   //echo $dir["Id_Producto_Dispensacion_Mipres"]." - ".$dir["Cantidad"]."<br>";
   $query="SELECT D.Id_Dispensacion, SUM(PD.Cantidad_Formulada) AS Formulada, SUM(PD.Cantidad_Entregada) AS Entregada, SUM(PF.Cantidad) AS Cantidad_Factura, PF.Precio, PF.Impuesto
           FROM Producto_Dispensacion PD
           INNER JOIN Dispensacion D ON D.Id_Dispensacion = PD.Id_Dispensacion
           INNER JOIN Producto_Factura PF ON PF.Id_Producto_Dispensacion = PD.Id_Producto_Dispensacion
           INNER JOIN Factura F ON F.Id_Factura = PF.Id_Factura
           WHERE F.Tipo='Factura' AND F.Estado_Factura != 'Anulada' AND F.Nota_Credito IS NULL  AND PD.Id_Producto_Dispensacion_Mipres =".$dir["Id_Producto_Dispensacion_Mipres"]."
    "; 
    //AND F.Nota_Credito IS NULL
    $oCon = new consulta();
    $oCon->setQuery($query);
    //$oCon->setTipo("Multiple");
    $dis = $oCon->getData();
    unset($oCon);
    
    $valor=number_format(($dis["Precio"]*$dis["Cantidad_Factura"])+($dis["Precio"]*($dis["Cantidad_Factura"]*$dis["Impuesto"]/100)),2,",","");
    
    echo "<tr><td>".$i."</td><td>".$dir["NoPrescripcion"]."</td><td>".$dir["ID"]."</td><td>".$dir["Id_Producto_Dispensacion_Mipres"]."</td><td>".$dir["Valor_Reportado"]."</td><td>".$valor."</td>";
    if(isset($dis["Id_Dispensacion"])&&$dis["Id_Dispensacion"]!=''){  
        
        if($dir["Anulado3"]!="Si"){
           // echo "<td>Voy a aNular</td>";
           $respuesta1= $mipres->AnularReporteEntrega($dir["IdReporteEntrega"]);
            if(isset($respuesta1["Errors"])){
                echo "<td>".$respuesta1["Errors"][0]."</td>";
            }else{
                echo "<td>ANULADO EXITOSAMENTE</td>";
                $oItem = new complex("Producto_Dispensacion_Mipres","Id_Producto_Dispensacion_Mipres",$dir["Id_Producto_Dispensacion_Mipres"]);
                $oItem->Anulado3 = "Si";
                $oItem->IdReporteEntrega=NULL;
                $oItem->Fecha_Reporte_Entrega=NULL;
                $oItem->Valor_Reportado=NULL;
                $oItem->save();
                unset($oItem);
            }
        }else{
            echo "<td>YA HA SIDO ANULADO</td>";
        }
            
            //echo "<td>VOY A ANULAR</td>";
        /*
        if($dir["Valor_Reportado"]!=$valor){ 
            
            
            if($dir["Anulado"]!="Si"){
               $respuesta1= $mipres->AnularReporteEntrega($dir["IdReporteEntrega"]);
                if(isset($respuesta1["Errors"])){
                    echo "<td>".$respuesta1["Errors"][0]."</td>";
                }else{
                    echo "<td>ANULADO EXITOSAMENTE</td>";
                    $oItem = new complex("Producto_Dispensacion_Mipres","Id_Producto_Dispensacion_Mipres",$dir["Id_Producto_Dispensacion_Mipres"]);
                    $oItem->Anulado = "Si";
                    $oItem->save();
                    unset($oItem);
                }
            }else{
                echo "<td>YA HA SIDO ANULADO</td>";
            }
            
            if($dir["Actualizado"]!="Si"){
                $data['ID']=(INT)$dir['ID'];
                $data['EstadoEntrega']=1;
                $data['CausaNoEntrega']=0;
                $data['ValorEntregado']=$valor;
                $respuesta2=$mipres->ReportarEntregaEfectiva($data);
               
                if($respuesta2[0]['Id']){
                    $oItem=new complex('Producto_Dispensacion_Mipres','Id_Producto_Dispensacion_Mipres',$dir['Id_Producto_Dispensacion_Mipres']);
                    $oItem->IdReporteEntrega=$respuesta2[0]['IdReporteEntrega'];
                    $oItem->Fecha_Reporte_Entrega=date("Y-m-d H:i:s");
                    $oItem->Valor_Reportado=$valor;
                    $oItem->Actualizado = "Si";
                    $oItem->save();
                    unset($oItem);
                    echo "<td>SE ACTUALIZO EL REPORTE ENTREGA</td>";
                }else{
                    
                    echo "<td>".$respuesta2["Errors"][0]."</td>";
                    //var_dump($respuesta2);
                    //$respuesta3=$mipres->ConsultaEntregaEfectiva($dir["NoPrescripcion"]);
                    //var_dump($respuesta3);
                    //exit;
                }
                
            }else{
                echo "<td>YA HA SIDO ACTUALIZADO</td>";
            }
            echo "</tr>";
            
        }else{
            echo "<td colspan='2'>SON IGUALES</td>";
            $oItem=new complex('Producto_Dispensacion_Mipres','Id_Producto_Dispensacion_Mipres',$dir['Id_Producto_Dispensacion_Mipres']);
            $oItem->Fecha_Reporte_Entrega=$dir["Fecha_Reporte"];
            $oItem->Valor_Reportado=$valor;
            $oItem->Actualizado = "Si";
            $oItem->save();
            unset($oItem);
        }
        */
        //var_dump($dis);
    }else{
        echo "<td colspan='2'>NO HAY REGISTROS</td>";
    }
    
    //echo "<br><br><br>";
   
}
 echo "</table>";  

//echo json_encode($direccionamientos,true);

?>