<?php
ini_set("memory_limit","32000M");
ini_set('max_execution_time', 0);

header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Headers: Origin, Content-Type, X-Auth-Token');
//header('Content-Type: application/json');

include_once('../class/class.querybasedatos.php');
include_once('../class/class.http_response.php');
include_once('../class/class.mipres.php');
include_once('../class/class.php_mailer.php');

$queryObj = new QueryBaseDatos();

$mipres= new Mipres();
    
    
    
$query='SELECT DM.Fecha_Direccionamiento, PDM.* 

FROM Producto_Dispensacion_Mipres PDM
INNER JOIN Dispensacion_Mipres DM ON DM.Id_Dispensacion_Mipres = PDM.Id_Dispensacion_Mipres
WHERE PDM.Estado_Direccionamiento IS NULL AND PDM.IdReporteEntrega IN (10769238,
12885038,
10767301,
13484559,
10767294,
9889881,
10766926,
10769464,
14622141,
11078016,
12885890,
13482216,
15173122,
15173117,
10769172,
13032483,
13484681,
10768441,
10768546,
10770146,
13482408,
13482396,
13482397,
13482104,
13482094,
10947435,
15167297,
15172997,
13958570,
13069757,
15172989,
10768756,
13482099,
12883613,
13483420,
10769075,
10769155,
13481370,
15173415,
12885594,
10770534,
13484953,
12846157,
13031182,
10769527,
10769528,
13482863,
10768401,
15509370,
14621800,
12885293,
14621793,
10768184,
12701647,
13482391,
12266251,
13482372,
13482363,
15173190,
15173210,
13067595,
12845898,
15509405,
10768201,
13067987,
15509404,
13482794,
13482793,
12986765,
13959168,
12474832,
13482824,
13482834,
16725989,
15174012,
15173913,
12846038,
12241284,
12153345,
13072528,
15173522,
13074681,
15173920,
12770636,
13482790,
15173585,
12885578,
15173524,
11951321,
12884945,
11203682,
15182929,
15182925,
13484483,
13483848,
13977581,
14621284,
15167596,
10768247,
15180265,
15180426,
15180124,
15180111,
12707580,
14621295,
14621298,
15180197,
15180166,
15180189,
15180205,
15182297,
15966194,
15509289,
15966196,
13483888,
13484109,
13960252,
10768349,
10768348,
10768350,
15181532,
15181579,
10767331,
13960251,
13978088,
13086318,
13086319,
15172775,
13958387,
15172771,
10768798,
15181008,
12993591,
12993590,
10768765,
13960143,
13977560,
10767486,
13481458,
12435073,
13977562,
12165482,
13483933,
15180868,
15180792,
10768313,
12883294,
10960763,
13481720,
15509311,
15509312,
13978153,
10767121,
10767120,
11257478,
15167757,
13484180,
15181851,
15181094,
11076824,
10770102,
13977545,
10770338,
13481413,
13481412,
15176246,
15176297,
10769966,
13975526,
14622176,
15174513,
15174640,
13072954,
15174636,
15174735,
13482662,
15173443,
15166801,
11265849,
10767006,
13959289,
15509426,
13483004,
13959296,
13979191,
10767042,
13481982,
15172840,
15172830,
13481952,
10767512,
11987730,
13481977,
12714010,
13481943,
11266754,
11266755,
10769033,
13481951,
15172820,
15172821,
15172851,
13481948,
15172829,
15172834,
15172825,
9878519,
12701970,
10768440,
13482013,
13958481,
12884233,
14621879,
15509334,
15172884,
10850082,
15174862,
13958529,
10775431,
10775432,
13482050,
15172937,
15172933,
15172932,
13482073,
14621870,
15172939,
14621874,
10768529,
15172935,
13977769,
14621576,
8812000,
15175018,
14621580,
15175068,
13483076,
13481464,
15509394,
13482656,
13482649,
13482655,
14621688,
13482650,
13482648,
14621108,
14621109,
14621106,
10767749,
17361786,
10851022,
14622168,
15175225,
13483095,
14621561,
15509439,
15509440,
10906191,
12883434,
12883431,
14622121,
13485043,
15175330,
14621784,
15173236,
10769168,
13482415,
13482416,
15166996,
15181621,
14621771,
13958841,
15965894,
13782526,
13482178,
10767352,
10769052,
12713776,
15173044,
10768051,
12996495,
10768190,
15173061,
15173040,
15173038,
15173009,
13072421,
15173008,
13978280,
16118948,
15167149,
15175515,
15175520,
15175519,
12877821,
15175507,
10766963,
15175513,
15175521,
15174432,
15174214,
10770033,
13482941,
14621636,
15165846,
13980322,
10770308,
16232598,
16232600,
11075992,
11075993,
15168107,
10861211,
11183330,
11183332,
14622138,
15172793,
16118924,
10770063,
10770064,
12074444,
15173317,
15173341,
15173312,
15173311,
11077925,
15173331,
13067619,
13483236,
15175564,
13483219,
11201580,
13783933,
15175657,
12877811,
14621512,
13483247,
13484475,
14622192,
14621736,
12895937,
13978008,
10772939,
13484367,
13484369,
15182637,
15182579,
15509524,
13484379,
10769423,
15175751,
15966086,
15175760,
13977694,
13977689,
10768013,
15211809,
15509450,
10767022,
15175745,
15175925,
15175768,
15175753,
13483276,
15175755,
15175752,
10767153,
15168271,
13959460,
13483279,
13483292,
13483364,
15175880,
14621450,
15175893,
14621700,
13482605,
13482608,
12883750,
13482573,
13482599,
15173376,
13481779,
14621936,
13481850,
12883352,
13481829,
13481828,
14977956,
15172379,
13481814,
15172486,
15172297,
15172746,
10768831,
10769565,
15172136,
15172070,
15171877,
8611462,
15173136,
15173146,
13482303,
10767781,
12885325,
12417247,
10770553,
15173134,
15173133,
15173132,
15173131,
13486048,
11256773,
12885534,
15176511,
15176592,
13482757,
13485670,
11259572,
11049032,
12883268,
12883270,
10769486,
15173477,
13482692,
12885549,
13483566,
10767900,
13964735,
15177048,
12885461,
13481279,
15176182,
15176146,
15176161,
15182972,
13483381,
13481282,
11986752,
13035497,
12995106,
13483610,
15177404,
13483594,
15177551,
10767078,
12885748,
12840524,
11208081,
15168316,
15178086,
14621366,
16708887,
10769204,
13483648,
13483999,
14978001,
13483679,
13483680,
13483685,
10769212,
10768370,
13069289,
13069288,
14621348,
10775383,
13037015,
13483721,
13037013,
13483719,
10768138,
12885724,
15184464,
15183829,
15179157,
9643184,
10768436,
15179465,
11328588,
10769370,
13975519,
9381520,
12884653,
15179487,
12884633,
15169113,
15169087,
10856340,
14620961,
14620960,
14622070,
14622056,
15169731,
15170604,
15168649,
15170303,
10766953,
15170284,
10768946,
13975586,
10767558,
14622013,
15170760,
16725774,
16708029,
16725770,
16708028,
14622031,
15171058,
10931642,
13481703,
10768634,
10766914,
14621327,
14621324,
15179806,
13483810,
10768259,
10768372,
12883557,
15509505,
14978011,
13484070,
10769380,
14621225,
14621229,
14621110,
15184135,
13977538,
11256336,
11256337,
10768439,
13977513,
15181790,
15181793,
8602690,
13484256,
13484278,
13484264,
15182091,
13484277,
15182037,
12882817,
15182351,
14621130,
15182740,
14621089,
14620876,
12771053,
13034221,
12996317,
15182824,
15182797,
10772856,
12018633,
15183119,
12018634,
15183109,
13484504,
12883944,
15509534,
15509535,
13068399,
13960934,
10769131,
13960931,
10770563,
14621020,
11349343,
13069758,
10768755,
13961086,
12838591,
11821008,
14620999,
14620998,
13031831,
10931783,
14621006,
14620997,
15183686,
10770483,
15188887,
10766997,
12770904,
13068286,
15183742,
12883248,
10768550,
13484760,
12227802,
15187151,
10767113,
10767300,
14620972,
14620974,
15184295,
15184274,
15184271,
15184285,
13977201,
14620931,
13961514,
15967755,
15967756,
15184416,
10768135,
15184432,
12242563,
15184577,
15184616,
14620903,
15184914,
15184950,
13484925,
13484943,
14620890,
14620887,
13976550,
10767773,
10779177,
15185179,
11986440,
13977231,
12703495,
12703496,
13484976,
15185108,
12886126,
15185121,
14620865,
15185516,
14620591,
14620694,
15185243,
15185189,
14620592,
15188006,
15185247,
14620840,
15185682,
15185705,
15185812,
10767936,
9399875,
15185918,
13977098,
14620805,
13485175,
8822512,
15185947,
12151847,
14620787,
15185978,
14620790,
15185974,
13485267,
13485269,
15186056,
15186057,
14620772,
10768704,
15186035,
15509623,
13485244,
13976683,
10772581,
15186124,
10770061,
14620619,
13485307,
10851627,
11207892,
13485321,
12711940,
10768228,
15186179,
15186164,
15186182,
15186227,
13962166,
11294004,
12885405,
12885403,
16233179,
16233183,
16233174,
15211987,
12714911,
13069456,
10768229,
10773035,
13485417,
14620733,
15186462,
15186436,
15186425,
15186603,
13977002,
12883958,
12883956,
10909637,
13964848,
15186758,
13485499,
15186896,
12243667,
10768899,
9427097,
15187024,
15187062,
15187033,
15187011,
15187070,
15187019,
13066436,
15186992,
12993856,
10850090,
13485564,
10768424,
15187344,
13485555,
15187510,
15187461,
15187574,
10915826,
15187740,
15187836,
15187762,
10767052,
12990484,
12990483,
15188162,
10768733,
12883720,
14620644,
12779330,
15188268,
10782269,
10782270,
15209645,
13485818,
13976727,
13976757,
13485782,
13485783,
13485785,
12885687,
13485816,
15188669,
15210007,
10768623,
11822495,
12074377,
14620584,
15209676,
10772007,
12418755,
15188857,
10584857,
12883205,
15209789,
12886075,
10906071,
10768221,
15209804,
13485918,
15212190,
11986650,
11203088,
15209849,
15209841,
15211814,
15209860,
15214451,
13976653,
10773036,
15209966,
15209933,
15967684,
15209950,
15209945,
14620519,
15509688,
15509693,
10766962,
13976588,
15210064,
15210081,
11128498,
11077913,
15210203,
12885695,
15213322,
15210252,
15210304,
12885265,
15210347,
10414801,
16233400,
10773964,
10773963,
14620534,
14978029,
15210394,
15210402,
10862413,
15210612,
13486177,
15213416,
15211802,
15210589,
15210548,
15210488,
13963750,
11201146,
14620473,
15210884,
15210882,
12227669,
11399368,
15211499,
15212893,
11201147,
13486137,
12886150,
10850256,
15213777,
11950612,
12884227,
11201223,
15509717,
13074212,
15211656,
15212218,
15211845,
12884070,
15967882,
15967888,
15211880,
15212708,
15212704,
10768547,
10770147,
10770123,
10770150,
15211935,
15509732,
16119134,
15212001,
11986727,
15212098,
15212166,
15212054,
10769590,
10767570,
15212194,
15212203,
15212286,
15212266,
12667535,
11260070,
12885227,
15212379,
15212487,
16119150,
13486242,
15212462,
15213582,
14620502,
13069246,
15212660,
12996916,
15509754,
15509756,
15212686,
15509755,
15509763,
13976027,
15212840,
13976026,
12884596,
15968161,
12882812,
13975942,
13975933,
13975885,
15968227,
15213349,
15213350,
15213357,
15213373,
14620484,
12993818,
13031443,
15213522,
15213633,
15213634,
15213712,
15213710,
15213898,
15215156,
14620470,
15214795,
15968568,
16119222,
15214798,
15968571,
16119221,
15215322,
15215268,
13964407,
15509820,
15509816,
15216443,
15215035,
16119272,
15216000,
15215998,
15214455,
15214849,
15214584,
15215247,
15215243,
15215171,
15215971,
15215320,
15215944,
15215392,
15215853,
15215774,
15215796,
15215674,
15215716,
15215602,
15215636,
15215594,
15215541,
15216475,
15216479,
15216722,
15969119,
16119301,
15216679,
10769167,
12852896,
15188252,
12885245,
10769522,
10769523,
10769972,
13484839,
10767130,
10772052,
11263281,
11263279,
10769266,
10769267,
10768467,
13484206)
'; 
$oCon = new consulta();
$oCon->setQuery($query);
$oCon->setTipo("Multiple");
$direccionamientos = $oCon->getData();
unset($oCon);
    

$i=0;    
echo "<table border='1' cellspacing='1' cellpadding='1'><tr><td>#</td><td>Prescripcion</td><td>ID</td><td>ID Programacion</td><td>Id Entrega</td><td>Anulado</td></tr>";
foreach($direccionamientos as $dir){ $i++;
   $query='SELECT PD.Id_Producto_Dispensacion, D.Codigo as Dis FROM Producto_Dispensacion PD INNER JOIN Dispensacion D ON D.Id_Dispensacion = PD.Id_Dispensacion WHERE D.Estado_Dispensacion!="Anulada" AND  PD.Id_Producto_Dispensacion_Mipres ='.$dir["Id_Producto_Dispensacion_Mipres"]; 
        $oCon = new consulta();
        $oCon->setQuery($query);
        $oCon->setTipo("Multiple");
        $dis = $oCon->getData();
        unset($oCon);

    $res='';
     echo "<tr><td>".$i."</td><td>".$dir["NoPrescripcion"]."</td><td>".$dir["ID"]."</td><td>".$dir["IdProgramacion"]."</td><td>".$dir["IdEntrega"]."</td>";
    if(!$dis){
        /*$respuesta1= $mipres->AnularProgramacion($dir["IdProgramacion"]);
        
        if(isset($respuesta1["Errors"])){
            echo "<td>".$respuesta1["Errors"][0]."</td>";
        }else{
            echo "<td>ANULADO EXITOSAMENTE</td>";
            $oItem = new complex("Producto_Dispensacion_Mipres","Id_Producto_Dispensacion_Mipres",$dir["Id_Producto_Dispensacion_Mipres"]);
            $oItem->Estado_Direccionamiento = "ANULADO";
            $oItem->save();
            unset($oItem);
        }*/
        echo "<td>SE VA A ANULAR - BOGOTA</td>";
    }else{
        echo "<td>YA TIENE DISPENSACION EN SIGESPRO - ".$dis[0]["Dis"]."</td>";
    }
    
   echo "</tr>";
    
    
    //$respuesta1= $mipres->AnularReporteEntrega($dir["IdReporteEntrega"]);
        
   //sleep(5); 
    //echo "<br><br><br>";
}
 echo "</table>";  

//echo json_encode($direccionamientos,true);

?>