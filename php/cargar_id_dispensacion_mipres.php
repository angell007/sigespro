<?php

error_reporting(E_ALL);
ini_set("display_errors", "On");

header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Headers: Origin, Content-Type, X-Auth-Token');
//header('Content-Type: application/json');

include_once '../class/class.querybasedatos.php';
include_once '../class/class.http_response.php';
require_once '../class/class.configuracion.php';
include_once '../class/class.portal_clientes.php';
include_once '../../class/class.facturaccionmasiva.php';

// include_once '../../class/class.integracion_positiva.php';
include_once '../helper/response.php';
include_once '../class/class.mipres.php';
require '../class/class.awsS3.php';



$reclamante = (isset($_REQUEST['reclamante']) ? $_REQUEST['reclamante'] : '');
$reclamante = (array) json_decode(mb_convert_encoding($reclamante, 'UTF-8'), true);

$queryObj = new QueryBaseDatos();
$oCon= new consulta();
/*$mipres= new Mipres();*/


$queryAnular = "SELECT 
                        PDM.IdFactura, 
                        PDM.IdReporteEntrega, 
                        PDM.IdEntrega,
                        PDM.NoPrescripcion
                FROM Producto_Dispensacion_Mipres PDM
                WHERE PDM.NoPrescripcion IN(
                    '20250722141001665507',
                    '20250709165001536164',
                    '20250709148001535656',
                    '20250708140001528980',
                    '20250708140001528980',
                    '20250708129001531034',
                    '20250707123001506904',
                    '20250707123001506904',
                    '20250707121001512634',
                    '20250707121001512634',
                    '20250704136001496827',
                    '20250704136001496827',
                    '20250703194001482382',
                    '20250703179001476445',
                    '20250703119001483307',
                    '20250703119001483307',
                    '20250702143001465217',
                    '20250701194001460647',
                    '20250701194001460647',
                    '20250701160001455129',
                    '20250701146001451308',
                    '20250701130001458027',
                    '20250630151001448682',
                    '20250629142001447936',
                    '20250629139001448110',
                    '20250628110001446924',
                    '20250627196001431579',
                    '20250627158001433094',
                    '20250626185001425280',
                    '20250626180001427629',
                    '20250626180001427629',
                    '20250626110001420222',
                    '20250626110001420222',
                    '20250625194001406173',
                    '20250625190001406449',
                    '20250625166001407875',
                    '20250624199001393644',
                    '20250624192001397857',
                    '20250624184001398109',
                    '20250624175001400942',
                    '20250624165001395937',
                    '20250624139001396547',
                    '20250624110001398473',
                    '20250624110001398473',
                    '20250621162001388641',
                    '20250621119001386562',
                    '20250621119001386562',
                    '20250621119001386562',
                    '20250620196001385382',
                    '20250620190001377061',
                    '20250620112001377361',
                    '20250620110001376600',
                    '20250620110001376600',
                    '20250619182001370946',
                    '20250619170001372815',
                    '20250619164001374623',
                    '20250619164001374623',
                    '20250619149001372336',
                    '20250619149001372336',
                    '20250619142001367791',
                    '20250619136001371593',
                    '20250619136001371593',
                    '20250619136001371593',
                    '20250619127001373076',
                    '20250619122001371913',
                    '20250619122001371913',
                    '20250619121001371497',
                    '20250619120001369726',
                    '20250619115001369296',
                    '20250619113001371002',
                    '20250618189001360513',
                    '20250618187001362944',
                    '20250618183001360309',
                    '20250618163001363504',
                    '20250618163001363504',
                    '20250617191001344688',
                    '20250617184001343093',
                    '20250617184001343093',
                    '20250617150001342485',
                    '20250617146001343267',
                    '20250617146001343267',
                    '20250617133001342621',
                    '20250617133001342621',
                    '20250617131001345936',
                    '20250617128001349128',
                    '20250617128001349128',
                    '20250617120001342121',
                    '20250617113001349978',
                    '20250617113001349978',
                    '20250616172001330091',
                    '20250616167001329078',
                    '20250616165001332590',
                    '20250616163001328343',
                    '20250616163001328343',
                    '20250616116001329814',
                    '20250616115001337290',
                    '20250614137001322023',
                    '20250613190001312886',
                    '20250613180001320104',
                    '20250613180001320104',
                    '20250613179001320090',
                    '20250613179001320090',
                    '20250613176001314403',
                    '20250613162001315396',
                    '20250613147001314725',
                    '20250613130001312894',
                    '20250613119001314555',
                    '20250613110001320197',
                    '20250613110001320197',
                    '20250612192001304528',
                    '20250612192001304528',
                    '20250612180001300731',
                    '20250612180001300731',
                    '20250612161001298335',
                    '20250612149001303615',
                    '20250612147001298780',
                    '20250612147001298780',
                    '20250612145001299783',
                    '20250612145001299783',
                    '20250612138001306050',
                    '20250611184001288661',
                    '20250611184001288661',
                    '20250611170001296322',
                    '20250611170001296322',
                    '20250611166001296347',
                    '20250611166001296347',
                    '20250611141001288858',
                    '20250611141001288858',
                    '20250611141001288858',
                    '20250611136001296333',
                    '20250611136001296333',
                    '20250611133001287076',
                    '20250610188001283562',
                    '20250610188001283562',
                    '20250610185001275825',
                    '20250610184001276336',
                    '20250610148001283408',
                    '20250610148001283408',
                    '20250610145001275288',
                    '20250610145001275288',
                    '20250610145001275288',
                    '20250610140001283520',
                    '20250610140001283520',
                    '20250610116001275523',
                    '20250609103001262315',
                    '20250609103001262315',
                    '20250607183001255640',
                    '20250607121001256770',
                    '20250607121001256770',
                    '20250607120001253404',
                    '20250607100001253614',
                    '20250606170001242632',
                    '20250606127001247840',
                    '20250605184001234135',
                    '20250605180001237985',
                    '20250605146001233153',
                    '20250605146001233153',
                    '20250605136001238762',
                    '20250605136001238762',
                    '20250605134001230052',
                    '20250604170001227824',
                    '20250604170001227824',
                    '20250604149001219028',
                    '20250603180001206481',
                    '20250603175001205182',
                    '20250603175001205182',
                    '20250603159001210753',
                    '20250603159001210753',
                    '20250603130001210469',
                    '20250603128001204586',
                    '20250603121001202845',
                    '20250601186001201223',
                    '20250601186001201223',
                    '20250601164001201225',
                    '20250601164001201225',
                    '20250601131001201209',
                    '20250601126001201218',
                    '20250601126001201218',
                    '20250531145001196558',
                    '20250531145001196558',
                    '20250531139001198830',
                    '20250531139001198830',
                    '20250531126001200473',
                    '20250531126001200473',
                    '20250530190001192952',
                    '20250530190001192952',
                    '20250530184001192227',
                    '20250530184001192227',
                    '20250530154001196210',
                    '20250530154001196210',
                    '20250530154001189642',
                    '20250530154001189642',
                    '20250530152001194734',
                    '20250530152001194734',
                    '20250530152001194734',
                    '20250530152001194363',
                    '20250530146001190811',
                    '20250530146001190811',
                    '20250530130001189232',
                    '20250530130001189232',
                    '20250530129001191769',
                    '20250530129001191769',
                    '20250529183001184304',
                    '20250529170001178016',
                    '20250529170001178016',
                    '20250529170001178016',
                    '20250529147001185272',
                    '20250529147001185272',
                    '20250529139001185333',
                    '20250529139001185333',
                    '20250529136001182513',
                    '20250529131001179353',
                    '20250528179001167905',
                    '20250528179001167905',
                    '20250528179001167044',
                    '20250528169001165748',
                    '20250528169001165748',
                    '20250528169001165748',
                    '20250528144001174464',
                    '20250528144001174464',
                    '20250528127001170285',
                    '20250528127001170285',
                    '20250528100001168490',
                    '20250528100001168490',
                    '20250527192001149345',
                    '20250527192001149345',
                    '20250527192001149345',
                    '20250527173001155140',
                    '20250527173001155140',
                    '20250527156001162190',
                    '20250527154001152422',
                    '20250527148001161974',
                    '20250527133001149362',
                    '20250526196001139712',
                    '20250526196001139712',
                    '20250526196001139712',
                    '20250526190001145605',
                    '20250526190001145605',
                    '20250526167001148184',
                    '20250526163001138309',
                    '20250526150001146256',
                    '20250526150001146256',
                    '20250526150001146256',
                    '20250526116001142338',
                    '20250526116001142338',
                    '20250526116001142338',
                    '20250525175001136134',
                    '20250524172001132778',
                    '20250524172001132778',
                    '20250524170001135140',
                    '20250524134001133431',
                    '20250524134001133431',
                    '20250524123001132004',
                    '20250523181001122955',
                    '20250523174001121193',
                    '20250523174001121193',
                    '20250523132001128701',
                    '20250523132001128701',
                    '20250522199001111228',
                    '20250522186001106880',
                    '20250522186001106880',
                    '20250522186001106880',
                    '20250522185001115172',
                    '20250522185001115172',
                    '20250522175001118700',
                    '20250522175001118700',
                    '20250522166001116130',
                    '20250522164001110400',
                    '20250522161001118853',
                    '20250522147001107313',
                    '20250522139001114950',
                    '20250522123001112192',
                    '20250522123001112192',
                    '20250521191001100686',
                    '20250521191001100686',
                    '20250521191001100686',
                    '20250521186001105257',
                    '20250521182001097926',
                    '20250521182001097926',
                    '20250521176001103736',
                    '20250521176001103736',
                    '20250521176001103736',
                    '20250521163001099788',
                    '20250521137001103271',
                    '20250521137001103271',
                    '20250521126001106725',
                    '20250521126001106725',
                    '20250521110001097218',
                    '20250520196001082440',
                    '20250520172001093645',
                    '20250520172001093645',
                    '20250520171001090940',
                    '20250520171001090940',
                    '20250520171001090940',
                    '20250520167001084823',
                    '20250520147001090908',
                    '20250520147001090908',
                    '20250520133001091095',
                    '20250520132001093808',
                    '20250520124001090707',
                    '20250520124001090707',
                    '20250520116001090711',
                    '20250520116001090711',
                    '20250520112001090397',
                    '20250519197001073493',
                    '20250519197001073493',
                    '20250519197001073493',
                    '20250519172001076816',
                    '20250519172001076816',
                    '20250519160001080344',
                    '20250519160001080344',
                    '20250519138001080310',
                    '20250519138001080310',
                    '20250518140001067372',
                    '20250518140001067372',
                    '20250517158001063608',
                    '20250516166001058760',
                    '20250516166001058760',
                    '20250516166001058760',
                    '20250516165001053798',
                    '20250516165001053798',
                    '20250516163001051646',
                    '20250516163001051646',
                    '20250516152001057611',
                    '20250516123001052304',
                    '20250516114001053862',
                    '20250515183001045483',
                    '20250515183001045483',
                    '20250515183001045483',
                    '20250515167001042256',
                    '20250515166001045968',
                    '20250515163001041048',
                    '20250515163001041048',
                    '20250515162001038600',
                    '20250515162001038600',
                    '20250515154001040278',
                    '20250515152001047331',
                    '20250515152001047331',
                    '20250515147001040359',
                    '20250515147001040359',
                    '20250515147001039832',
                    '20250515147001039832',
                    '20250515146001049397',
                    '20250515146001049397',
                    '20250515146001049397',
                    '20250515136001049219',
                    '20250515136001049219',
                    '20250515133001040931',
                    '20250515126001040395',
                    '20250515126001040395',
                    '20250515126001040395',
                    '20250514188001029348',
                    '20250514178001035431',
                    '20250514178001035431',
                    '20250514178001035431',
                    '20250514176001031647',
                    '20250514176001031647',
                    '20250514170001029799',
                    '20250514170001029799',
                    '20250514170001026132',
                    '20250514170001026132',
                    '20250514170001026132',
                    '20250514136001035136',
                    '20250514136001035136',
                    '20250514125001027248',
                    '20250514125001027248',
                    '20250514125001027248',
                    '20250514114001031437',
                    '20250514114001031437',
                    '20250513183001010565',
                    '20250513183001010565',
                    '20250513178001019068',
                    '20250513178001019068',
                    '20250513164001014250',
                    '20250513125001016171',
                    '20250512192001005564',
                    '20250512192001005564',
                    '20250512192001005564',
                    '20250512183000999061',
                    '20250512176001009574',
                    '20250512176001009574',
                    '20250512173001005579',
                    '20250512173001005579',
                    '20250512173001005579',
                    '20250512168001005479',
                    '20250512168001005479',
                    '20250512134001006309',
                    '20250510176000991240',
                    '20250510176000991240',
                    '20250510144000995530',
                    '20250510144000995530',
                    '20250510144000995530',
                    '20250510116000995536',
                    '20250510116000995536',
                    '20250510116000995536',
                    '20250509182000984749',
                    '20250509182000984749',
                    '20250509182000984749',
                    '20250509177000984846',
                    '20250509177000984846',
                    '20250509150000980046',
                    '20250509150000980046',
                    '20250509142000982934',
                    '20250509142000982934',
                    '20250509142000982934',
                    '20250508188000971077',
                    '20250508161000967286',
                    '20250508161000967286',
                    '20250508161000967286',
                    '20250508157000968216',
                    '20250508157000968216',
                    '20250508157000968216',
                    '20250508145000972805',
                    '20250508145000972805',
                    '20250508134000971383',
                    '20250508134000971383',
                    '20250508134000971383',
                    '20250508129000975387',
                    '20250508129000975387',
                    '20250508129000975387',
                    '20250508121000972848',
                    '20250508110000975313',
                    '20250507143000952653',
                    '20250507143000952653',
                    '20250507129000962564',
                    '20250507124000953150',
                    '20250507112000953753',
                    '20250506192000946976',
                    '20250506192000946976',
                    '20250506192000946976',
                    '20250506186000952043',
                    '20250506186000952043',
                    '20250506185000944266',
                    '20250506185000944266',
                    '20250506132000949203',
                    '20250506132000949203',
                    '20250506131000949774',
                    '20250506131000949774',
                    '20250505199000937858',
                    '20250505199000937858',
                    '20250505199000937858',
                    '20250505170000927797',
                    '20250505170000927797',
                    '20250505159000928934',
                    '20250505150000935119',
                    '20250505150000935119',
                    '20250503190000923154',
                    '20250503190000923154',
                    '20250503190000923154',
                    '20250503178000921627',
                    '20250503141000922407',
                    '20250503141000922407',
                    '20250502176000914802',
                    '20250502119000913379',
                    '20250502119000913379',
                    '20250502119000913379',
                    '20250501190000906877',
                    '20250501190000906877',
                    '20250501130000906744',
                    '20250501130000906744',
                    '20250430176000900168',
                    '20250430176000900168',
                    '20250430137000895049',
                    '20250430137000895049',
                    '20250430137000895049',
                    '20250430135000901613',
                    '20250430135000901613',
                    '20250430113000897740',
                    '20250430113000897740',
                    '20250430113000897740',
                    '20250429197000878920',
                    '20250429197000878920',
                    '20250429191000888742',
                    '20250429191000888742',
                    '20250429170000884629',
                    '20250429165000892260',
                    '20250429165000892260',
                    '20250429163000888845',
                    '20250429163000888845',
                    '20250429163000888845',
                    '20250429160000892721',
                    '20250429160000892721',
                    '20250429160000892721',
                    '20250429155000887340',
                    '20250429153000884946',
                    '20250429153000884946',
                    '20250429153000884946',
                    '20250429140000885381',
                    '20250429126000889825',
                    '20250429126000889825',
                    '20250429123000886970',
                    '20250429123000886970',
                    '20250429123000886970',
                    '20250429115000879282',
                    '20250429115000879282',
                    '20250429110000892153',
                    '20250429110000892153',
                    '20250429110000892153',
                    '20250428164000876076',
                    '20250428136000864518',
                    '20250428136000864518',
                    '20250428136000864518',
                    '20250428127000872174',
                    '20250428127000872174',
                    '20250427190000862459',
                    '20250427171000863486',
                    '20250427146000862481',
                    '20250427146000862481',
                    '20250427146000862481',
                    '20250427129000863466',
                    '20250426154000858859',
                    '20250426154000858859',
                    '20250426154000858859',
                    '20250425179000842813',
                    '20250425179000842813',
                    '20250425179000842813',
                    '20250425177000850376',
                    '20250425177000850376',
                    '20250425166000843484',
                    '20250425166000843484',
                    '20250425166000843484',
                    '20250425136000847953',
                    '20250425136000847953',
                    '20250425114000852496',
                    '20250424192000836385',
                    '20250424192000836385',
                    '20250424165000829615',
                    '20250424165000829615',
                    '20250424149000832314',
                    '20250424149000832314',
                    '20250424110000832375',
                    '20250424110000832375',
                    '20250423181000816723',
                    '20250423181000816723',
                    '20250423178000817831',
                    '20250423178000817831',
                    '20250423178000817831',
                    '20250423171000817039',
                    '20250423171000817039',
                    '20250423163000820739',
                    '20250423163000820739',
                    '20250423163000820739',
                    '20250423155000816394',
                    '20250423151000824248',
                    '20250423151000824248',
                    '20250423134000818366',
                    '20250422159000808386',
                    '20250422119000808558',
                    '20250421145000800500',
                    '20250421145000800500',
                    '20250421145000800500',
                    '20250421138000800545',
                    '20250421138000800545',
                    '20250421138000800545',
                    '20250421137000789063',
                    '20250421137000789063',
                    '20250421137000789063',
                    '20250421130000793435',
                    '20250421130000793435',
                    '20250421130000793435',
                    '20250421123000800028',
                    '20250421123000800028',
                    '20250421123000800028',
                    '20250416189000772961',
                    '20250416189000772961',
                    '20250416189000772961',
                    '20250416159000775930',
                    '20250416159000775930',
                    '20250416159000775930',
                    '20250415195000767212',
                    '20250415195000767212',
                    '20250415193000759564',
                    '20250415185000769384',
                    '20250415179000769603',
                    '20250415179000769603',
                    '20250415179000769603',
                    '20250415163000756961',
                    '20250415163000756961',
                    '20250415163000756961',
                    '20250415158000765803',
                    '20250415158000765803',
                    '20250415147000758884',
                    '20250415147000758884',
                    '20250415147000758884',
                    '20250415122000760130',
                    '20250414197000751818',
                    '20250414190000751666',
                    '20250414190000751666',
                    '20250414189000752098',
                    '20250414189000752098',
                    '20250414189000752098',
                    '20250414113000745473',
                    '20250414113000745473',
                    '20250414111000752184',
                    '20250414111000752184',
                    '20250414111000752184',
                    '20250413126000742430',
                    '20250413126000742430',
                    '20250413126000742430',
                    '20250412183000738627',
                    '20250412151000740530',
                    '20250412151000740530',
                    '20250412151000740530',
                    '20250412148000737862',
                    '20250412148000737862',
                    '20250412148000737862',
                    '20250412144000737576',
                    '20250412144000737576',
                    '20250412144000737576',
                    '20250411171000727174',
                    '20250411163000732250',
                    '20250411163000732250',
                    '20250411163000732250',
                    '20250410183000713539',
                    '20250410143000722521',
                    '20250410143000722521',
                    '20250410143000722521',
                    '20250410126000711884',
                    '20250410126000711884',
                    '20250410120000708770',
                    '20250410120000708770',
                    '20250410116000714174',
                    '20250409160000703394',
                    '20250409160000703394',
                    '20250409111000705656',
                    '20250409111000705656',
                    '20250409111000705656',
                    '20250409111000705656',
                    '20250409111000705656',
                    '20250408196000683179',
                    '20250408185000692927',
                    '20250408185000692927',
                    '20250408185000692927',
                    '20250408174000685750',
                    '20250408174000685750',
                    '20250408174000685750',
                    '20250408169000687934',
                    '20250408169000687934',
                    '20250408169000687934',
                    '20250408158000687059',
                    '20250408158000687059',
                    '20250408158000687059',
                    '20250408153000690898',
                    '20250408146000682996',
                    '20250408146000682996',
                    '20250408145000692090',
                    '20250408145000692090',
                    '20250408145000692090',
                    '20250408124000684084',
                    '20250408124000684084',
                    '20250408124000684084',
                    '20250408119000692745',
                    '20250408119000692745',
                    '20250407186000673017',
                    '20250407170000668647',
                    '20250407170000668647',
                    '20250407170000668647',
                    '20250407165000678098',
                    '20250407165000678098',
                    '20250407153000672871',
                    '20250407153000672871',
                    '20250407153000672871',
                    '20250407131000677438',
                    '20250407131000677438',
                    '20250407131000677438',
                    '20250407129000674328',
                    '20250407129000674328',
                    '20250407129000674328',
                    '20250407113000669600',
                    '20250407113000669600',
                    '20250407113000669600',
                    '20250405164000663563',
                    '20250405164000663563',
                    '20250405164000663563',
                    '20250405136000662264',
                    '20250405136000662264',
                    '20250405136000662264',
                    '20250405136000662264',
                    '20250404198000659884',
                    '20250404198000659884',
                    '20250404198000659884',
                    '20250404167000653915',
                    '20250404167000653915',
                    '20250404167000653915',
                    '20250404123000649138',
                    '20250404123000649138',
                    '20250404123000649138',
                    '20250404121000657925',
                    '20250404121000657925',
                    '20250404121000657925',
                    '20250404118000653477',
                    '20250404118000653477',
                    '20250403194000644242',
                    '20250403194000644242',
                    '20250403194000644242',
                    '20250403177000644076',
                    '20250403177000644076',
                    '20250403158000647780',
                    '20250403158000647780',
                    '20250403158000647780',
                    '20250403120000638705',
                    '20250403120000638705',
                    '20250403120000638705',
                    '20250402191000633994',
                    '20250402175000633180',
                    '20250402155000623956',
                    '20250402125000621054',
                    '20250402125000621054',
                    '20250402125000621054',
                    '20250401184000613954',
                    '20250401184000613954',
                    '20250401182000620663',
                    '20250401182000620663',
                    '20250401182000620663',
                    '20250401170000608186',
                    '20250401170000608186',
                    '20250401170000608186',
                    '20250401169000620309',
                    '20250401169000620309',
                    '20250401165000614494',
                    '20250401165000614494',
                    '20250401163000617685',
                    '20250401163000617685',
                    '20250401163000617685',
                    '20250401145000617917',
                    '20250401145000617917',
                    '20250401145000617917',
                    '20250401136000608205',
                    '20250401136000608205',
                    '20250401136000608205',
                    '20250331198000597984',
                    '20250331179000599641',
                    '20250331179000599641',
                    '20250331164000601379',
                    '20250331164000601379',
                    '20250331148000600366',
                    '20250331148000600366',
                    '20250331148000600366',
                    '20250331115000599435',
                    '20250331103000602252',
                    '20250331103000602252',
                    '20250331103000602252',
                    '20250329194000593746',
                    '20250329194000593746',
                    '20250329194000593746',
                    '20250329157000593128',
                    '20250329157000593128',
                    '20250329157000593128',
                    '20250329133000595851',
                    '20250329133000595851',
                    '20250329133000595851',
                    '20250328196000584798',
                    '20250328186000582612',
                    '20250328186000582612',
                    '20250328159000582844',
                    '20250328159000582844',
                    '20250328159000582844',
                    '20250328152000586591',
                    '20250328152000586591',
                    '20250328138000589853',
                    '20250328138000589853',
                    '20250328138000589853',
                    '20250328121000587550',
                    '20250328121000587550',
                    '20250328121000587550',
                    '20250328121000587550',
                    '20250328121000587550',
                    '20250328120000591701',
                    '20250328120000591701',
                    '20250328113000583999',
                    '20250328113000583999',
                    '20250327195000573714',
                    '20250327189000574752',
                    '20250327179000580595',
                    '20250327160000580480',
                    '20250327160000580480',
                    '20250327159000579206',
                    '20250327159000579206',
                    '20250327159000579206',
                    '20250327132000575441',
                    '20250327128000579510',
                    '20250326191000566987',
                    '20250326191000566987',
                    '20250326161000561539',
                    '20250326161000561539',
                    '20250326161000561539',
                    '20250326154000568325',
                    '20250326146000566525',
                    '20250326146000566525',
                    '20250326146000566525',
                    '20250326146000566525',
                    '20250326140000566652',
                    '20250326140000566652',
                    '20250326140000566652',
                    '20250326122000564256',
                    '20250326122000564256',
                    '20250326122000564256',
                    '20250326118000570303',
                    '20250326113000570561',
                    '20250326113000570561',
                    '20250326113000570561',
                    '20250325196000556860',
                    '20250325196000556860',
                    '20250325196000556860',
                    '20250325154000555500',
                    '20250325150000551358',
                    '20250325150000551358',
                    '20250325150000551358',
                    '20250325138000561049',
                    '20250325138000561049',
                    '20250325138000561049',
                    '20250325138000552843',
                    '20250325138000552843',
                    '20250325138000552843',
                    '20250325127000560985',
                    '20250325122000551743',
                    '20250324182000550989',
                    '20250324182000550989',
                    '20250324182000550989',
                    '20250323168000548990',
                    '20250323168000548990',
                    '20250323132000548960',
                    '20250323132000548960',
                    '20250323132000548960',
                    '20250322146000547455',
                    '20250322146000547455',
                    '20250322146000547455',
                    '20250321189000541515',
                    '20250321189000541515',
                    '20250321189000541515',
                    '20250321172000537745',
                    '20250321172000537745',
                    '20250321172000537745',
                    '20250321159000538774',
                    '20250321159000538774',
                    '20250321149000535096',
                    '20250321131000536450',
                    '20250321126000542970',
                    '20250321126000542970',
                    '20250321126000542970',
                    '20250320185000525313',
                    '20250320185000525313',
                    '20250320185000525313',
                    '20250320184000527939',
                    '20250320184000527939',
                    '20250320184000527939',
                    '20250320170000528875',
                    '20250320170000528875',
                    '20250320170000528875',
                    '20250320158000527697',
                    '20250320158000527697',
                    '20250320158000527697',
                    '20250320157000531282',
                    '20250320154000531037',
                    '20250320154000531037',
                    '20250320131000526263',
                    '20250320131000526263',
                    '20250320131000526263',
                    '20250319196000517061',
                    '20250319196000517061',
                    '20250319196000517061',
                    '20250319184000515473',
                    '20250319184000515473',
                    '20250319184000515473',
                    '20250319178000519714',
                    '20250319178000519714',
                    '20250319126000514736',
                    '20250319126000514736',
                    '20250319126000514736',
                    '20250319125000521846',
                    '20250319125000521846',
                    '20250319125000521846',
                    '20250319110000518345',
                    '20250319110000518345',
                    '20250319110000518345',
                    '20250318194000511713',
                    '20250318194000511713',
                    '20250318194000511713',
                    '20250318185000512061',
                    '20250318185000512061',
                    '20250318185000512061',
                    '20250318122000513220',
                    '20250318122000513220',
                    '20250318122000513220',
                    '20250318119000507461',
                    '20250318119000507461',
                    '20250318116000512467',
                    '20250318112000502830',
                    '20250318112000502830',
                    '20250318112000502830',
                    '20250317186000502158',
                    '20250317186000502158',
                    '20250317186000502158',
                    '20250317167000494047',
                    '20250317151000497292',
                    '20250317151000497292',
                    '20250317150000492872',
                    '20250317150000492872',
                    '20250316164000490075',
                    '20250316164000490075',
                    '20250316137000490031',
                    '20250316137000490031',
                    '20250316137000490031',
                    '20250314167000485755',
                    '20250314167000485755',
                    '20250314167000482317',
                    '20250314167000482317',
                    '20250314167000482317',
                    '20250314133000485760',
                    '20250314133000485760',
                    '20250314133000485760',
                    '20250313179000475590',
                    '20250313179000475590',
                    '20250313175000475572',
                    '20250313175000475572',
                    '20250313165000474072',
                    '20250313165000474072',
                    '20250313147000468640',
                    '20250313147000468640',
                    '20250313146000470742',
                    '20250313146000470742',
                    '20250313146000470742',
                    '20250313146000470742',
                    '20250313119000468822',
                    '20250313119000468822',
                    '20250312174000455494',
                    '20250312174000455494',
                    '20250312171000464919',
                    '20250312171000464919',
                    '20250312171000464919',
                    '20250312125000462869',
                    '20250312125000462869',
                    '20250312125000462869',
                    '20250311152000447755',
                    '20250311152000447755',
                    '20250311152000447755',
                    '20250311132000448164',
                    '20250311132000448164',
                    '20250311113000443602',
                    '20250311113000443602',
                    '20250311113000443552',
                    '20250310144000437038',
                    '20250310144000437038',
                    '20250310144000437038',
                    '20250310143000432767',
                    '20250310143000432767',
                    '20250310143000432767',
                    '20250310113000436035',
                    '20250310113000436035',
                    '20250310113000436035',
                    '20250308170000431470',
                    '20250308170000431470',
                    '20250308146000431196',
                    '20250308146000431196',
                    '20250308146000431196',
                    '20250308143000430460',
                    '20250308143000430460',
                    '20250308143000430460',
                    '20250308143000430460',
                    '20250308143000430460',
                    '20250307190000423703',
                    '20250307190000423703',
                    '20250307190000423703',
                    '20250307114000427219',
                    '20250307110000426461',
                    '20250306187000417029',
                    '20250306187000417029',
                    '20250306187000417029',
                    '20250305190000408680',
                    '20250305190000408680',
                    '20250305190000408680',
                    '20250305147000403166',
                    '20250305147000403166',
                    '20250305147000403166',
                    '20250305138000407433',
                    '20250305138000407433',
                    '20250305138000407433',
                    '20250304183000396555',
                    '20250304183000396555',
                    '20250304143000393719',
                    '20250304143000393719',
                    '20250304143000393719',
                    '20250304130000393736',
                    '20250304130000393736',
                    '20250304130000393736',
                    '20250304120000399678',
                    '20250304120000399678',
                    '20250303183000389442',
                    '20250303178000392625',
                    '20250303178000392625',
                    '20250303175000385456',
                    '20250303175000385456',
                    '20250303175000385456',
                    '20250303154000389004',
                    '20250303154000389004',
                    '20250303154000389004',
                    '20250303149000387798',
                    '20250303143000392046',
                    '20250303143000392046',
                    '20250303143000392046',
                    '20250303133000388697',
                    '20250303133000388697',
                    '20250303133000388697',
                    '20250303130000385574',
                    '20250303130000385574',
                    '20250303130000385574',
                    '20250303124000390221',
                    '20250303124000390221',
                    '20250303124000390221',
                    '20250303118000391137',
                    '20250302179000385395',
                    '20250302179000385395',
                    '20250302179000385395',
                    '20250302156000384968',
                    '20250302156000384968',
                    '20250302156000384968',
                    '20250302154000385053',
                    '20250302154000385053',
                    '20250302154000385053',
                    '20250302145000385119',
                    '20250302145000385119',
                    '20250302145000385119',
                    '20250302131000385424',
                    '20250302131000385424',
                    '20250302131000385424',
                    '20250228192000381192',
                    '20250228192000381192',
                    '20250228192000381192',
                    '20250228182000373968',
                    '20250228182000373968',
                    '20250228182000373968',
                    '20250228177000373890',
                    '20250228177000373890',
                    '20250228167000373859',
                    '20250228167000373859',
                    '20250228167000373859',
                    '20250228155000382037',
                    '20250228155000382037',
                    '20250228155000382037',
                    '20250228133000381294',
                    '20250228133000381294',
                    '20250228133000381294',
                    '20250228130000379121',
                    '20250228130000379121',
                    '20250228118000378402',
                    '20250228112000374900',
                    '20250227198000371975',
                    '20250227198000371975',
                    '20250227189000369630',
                    '20250227184000369466',
                    '20250227161000369101',
                    '20250227161000369101',
                    '20250227151000373607',
                    '20250227151000373607',
                    '20250227151000373607',
                    '20250227116000368743',
                    '20250227116000368743',
                    '20250227112000368591',
                    '20250227112000368591',
                    '20250227112000368591',
                    '20250227106000370384',
                    '20250226175000358196',
                    '20250226175000358196',
                    '20250226175000358196',
                    '20250226173000356586',
                    '20250226173000356586',
                    '20250226173000356586',
                    '20250226140000359512',
                    '20250226116000364737',
                    '20250226116000364737',
                    '20250226113000357757',
                    '20250226113000357757',
                    '20250225199000355518',
                    '20250225196000349525',
                    '20250225196000349525',
                    '20250225196000349525',
                    '20250225185000351282',
                    '20250225185000351282',
                    '20250225185000351282',
                    '20250225180000352270',
                    '20250225180000352270',
                    '20250225180000352270',
                    '20250225176000347437',
                    '20250225176000347437',
                    '20250224186000342073',
                    '20250224178000340279',
                    '20250224178000340279',
                    '20250224178000340279',
                    '20250224159000342450',
                    '20250224159000342450',
                    '20250224151000339724',
                    '20250224151000339724',
                    '20250224134000342033',
                    '20250224130000343075',
                    '20250224130000343075',
                    '20250224130000343075',
                    '20250224128000339574',
                    '20250224128000339574',
                    '20250224128000339574',
                    '20250224117000340328',
                    '20250224117000340328',
                    '20250224113000344412',
                    '20250224113000344412',
                    '20250224113000344412',
                    '20250223193000336085',
                    '20250223193000336085',
                    '20250223193000336085',
                    '20250223172000336668',
                    '20250223172000336668',
                    '20250223172000336668',
                    '20250223131000336572',
                    '20250223131000336572',
                    '20250223131000336572',
                    '20250222191000335659',
                    '20250222191000335659',
                    '20250222191000335659',
                    '20250222176000335699',
                    '20250222176000335699',
                    '20250222152000336079',
                    '20250222100000334836',
                    '20250221192000332904',
                    '20250221192000332904',
                    '20250221192000332904',
                    '20250221191000330453',
                    '20250221191000330453',
                    '20250221191000330453',
                    '20250221175000325318',
                    '20250221151000327093',
                    '20250221151000327093',
                    '20250221151000327093',
                    '20250221150000325824',
                    '20250221134000327784',
                    '20250221121000332844',
                    '20250221121000332844',
                    '20250221121000332844',
                    '20250220170000319536',
                    '20250220170000319536',
                    '20250220144000318870',
                    '20250220144000318870',
                    '20250220140000323295',
                    '20250220140000323295',
                    '20250220140000323295',
                    '20250220121000324568',
                    '20250220121000324568',
                    '20250220120000322265',
                    '20250220120000322265',
                    '20250220120000322265',
                    '20250219157000313323',
                    '20250219157000313323',
                    '20250219157000313323',
                    '20250219155000307661',
                    '20250219155000307661',
                    '20250219142000308630',
                    '20250219142000308630',
                    '20250219142000308630',
                    '20250218181000302065',
                    '20250218153000305660',
                    '20250218128000303073',
                    '20250218128000303073',
                    '20250218128000303073',
                    '20250217173000292448',
                    '20250217173000292448',
                    '20250217173000292448',
                    '20250217166000291714',
                    '20250217166000291714',
                    '20250217146000295162',
                    '20250217146000295162',
                    '20250217146000295162',
                    '20250217127000297524',
                    '20250217127000297524',
                    '20250217127000297524',
                    '20250217123000291996',
                    '20250215171000285776',
                    '20250215171000285776',
                    '20250215171000285776',
                    '20250215165000287336',
                    '20250215165000287336',
                    '20250215146000284690',
                    '20250215146000284690',
                    '20250215103000284778',
                    '20250215103000284778',
                    '20250215103000284778',
                    '20250215103000284778',
                    '20250214178000278935',
                    '20250214178000278935',
                    '20250214178000278935',
                    '20250214145000279210',
                    '20250214145000279210',
                    '20250214145000279210',
                    '20250214138000278256',
                    '20250214138000278256',
                    '20250214138000278256',
                    '20250214130000284088',
                    '20250214130000284088',
                    '20250214121000277581',
                    '20250214121000277581',
                    '20250214121000277581',
                    '20250214118000283804',
                    '20250214118000283804',
                    '20250214116000284157',
                    '20250214116000284157',
                    '20250214116000284157',
                    '20250214111000281583',
                    '20250214111000281583',
                    '20250213123000276108',
                    '20250213123000276108',
                    '20250213123000276108',
                    '20250212189000264437',
                    '20250212189000264437',
                    '20250212178000258829',
                    '20250212178000258829',
                    '20250212178000258829',
                    '20250212160000263768',
                    '20250212160000263768',
                    '20250212160000263768',
                    '20250212113000263256',
                    '20250212113000263256',
                    '20250212110000263900',
                    '20250212110000263900',
                    '20250212110000263900',
                    '20250211185000257105',
                    '20250211185000257105',
                    '20250211185000257105',
                    '20250211155000252378',
                    '20250211155000252378',
                    '20250211140000252111',
                    '20250211135000252450',
                    '20250211124000255152',
                    '20250211124000255152',
                    '20250211124000255152',
                    '20250210180000249154',
                    '20250210160000247859',
                    '20250210160000247859',
                    '20250210160000247859',
                    '20250210160000247859',
                    '20250210160000247859',
                    '20250209182000240465',
                    '20250209182000240465',
                    '20250209157000240184',
                    '20250209157000240184',
                    '20250209157000240184',
                    '20250208165000238956',
                    '20250208165000238956',
                    '20250207189000228941',
                    '20250207189000228941',
                    '20250207189000228941',
                    '20250207186000228952',
                    '20250207186000228952',
                    '20250207184000231996',
                    '20250207139000234207',
                    '20250207139000234207',
                    '20250206170000220375',
                    '20250206170000220375',
                    '20250206166000225224',
                    '20250206166000225224',
                    '20250206166000225224',
                    '20250206130000228727',
                    '20250206130000228727',
                    '20250206130000228727',
                    '20250206111000223319',
                    '20250205197000211661',
                    '20250205197000211661',
                    '20250205189000216058',
                    '20250205189000216058',
                    '20250205189000216058',
                    '20250205189000216058',
                    '20250205189000216058',
                    '20250205189000216058',
                    '20250205167000217591',
                    '20250205167000217591',
                    '20250205167000217591',
                    '20250205163000220296',
                    '20250205163000220296',
                    '20250205120000220314',
                    '20250205120000220314',
                    '20250205119000220243',
                    '20250205119000220243',
                    '20250205119000220243',
                    '20250204111000203121',
                    '20250204111000203121',
                    '20250204111000203121',
                    '20250203191000197183',
                    '20250203191000197183',
                    '20250203183000200343',
                    '20250203166000199194',
                    '20250203148000197914',
                    '20250203148000197914',
                    '20250203148000197914',
                    '20250203146000200859',
                    '20250203146000200859',
                    '20250202161000195069',
                    '20250202161000195069',
                    '20250202125000195124',
                    '20250202125000195124',
                    '20250202125000195124',
                    '20250201140000192861',
                    '20250201140000192861',
                    '20250201140000192861',
                    '20250131192000189365',
                    '20250130134000175649',
                    '20250130129000179457',
                    '20250130129000174792',
                    '20250130129000174792',
                    '20250130129000174792',
                    '20250130111000174813',
                    '20250129197000169064',
                    '20250129177000174690',
                    '20250129170000168068',
                    '20250129163000173325',
                    '20250129158000174664',
                    '20250129158000174664',
                    '20250129137000167508',
                    '20250129137000167508',
                    '20250129127000167594',
                    '20250129127000167594',
                    '20250128193000160188',
                    '20250128193000160188',
                    '20250128151000158088',
                    '20250128149000157626',
                    '20250128144000157554',
                    '20250126126000146478',
                    '20250126126000146478',
                    '20250126126000146239',
                    '20250126126000146239',
                    '20250125143000142939',
                    '20250125130000143694',
                    '20250125130000143694',
                    '20250124182000135611',
                    '20250124182000135611',
                    '20250124173000136699',
                    '20250124173000136699',
                    '20250124173000136699',
                    '20250123177000132478',
                    '20250123176000126644',
                    '20250123176000126644',
                    '20250123136000134355',
                    '20250123136000134355',
                    '20250123136000134355',
                    '20250122145000118333',
                    '20250121195000111644',
                    '20250121195000111644',
                    '20250121180000108735',
                    '20250121150000109511',
                    '20250120146000101654',
                    '20250120140000103052',
                    '20250120140000103052',
                    '20250120123000105367',
                    '20250120123000105367',
                    '20250120123000105367',
                    '20250118198000092513',
                    '20250118196000095119',
                    '20250118196000095119',
                    '20250118183000092849',
                    '20250117173000085928',
                    '20250116191000081939',
                    '20250116188000080651',
                    '20250116188000080651',
                    '20250115183000065604',
                    '20250115113000069658',
                    '20250115113000069658',
                    '20250115113000069658',
                    '20250114131000057102',
                    '20250113193000052903',
                    '20250113163000050403',
                    '20250113163000050403',
                    '20250113163000050403',
                    '20250113163000050403',
                    '20250113163000050403',
                    '20250113110000053748',
                    '20250112128000046926',
                    '20250112128000046926',
                    '20250112128000046926',
                    '20250112113000047638',
                    '20250111170000046408',
                    '20250110194000039626',
                    '20250110170000040215',
                    '20250110141000040832',
                    '20250110141000040832',
                    '20250110130000037620',
                    '20250109199000028052',
                    '20250109198000031821',
                    '20250108185000024274',
                    '20250108147000026572',
                    '20250108128000020823',
                    '20250108123000020751',
                    '20250105110000011785',
                    '20250105110000011785',
                    '20250103135000006959',
                    '20250102140000003256',
                    '20241230153039930834',
                    '20241230120039927377',
                    '20241227113039920937',
                    '20241223125039903393',
                    '20241220152039890692',
                    '20241220152039890692',
                    '20241220127039889336',
                    '20241219177039881522',
                    '20241218187039875693',
                    '20241218179039870974',
                    '20241216138039853205',
                    '20241216117039855467',
                    '20241212149039830765',
                    '20241212147039836309',
                    '20241212121039832360',
                    '20241206135039795157',
                    '20241205191039791945',
                    '20241205189039787830',
                    '20241205155039788172',
                    '20241205146039786887',
                    '20241204195039777623',
                    '20241204185039782280',
                    '20241204139039779778',
                    '20241204130039783628',
                    '20241204130039779344',
                    '20241204121039781765',
                    '20241204120039775676',
                    '20241204120039775676',
                    '20241204120039775676',
                    '20241204110039782320',
                    '20241204110039782187',
                    '20241204110039782187',
                    '20241130187039755998',
                    '20241130147039754037',
                    '20241129193039752970',
                    '20241129193039750403',
                    '20241129192039752896',
                    '20241129191039750672',
                    '20241129190039752726',
                    '20241129189039753247',
                    '20241129186039749177',
                    '20241129177039752646',
                    '20241129170039750038',
                    '20241129169039750208',
                    '20241129157039753017',
                    '20241129155039752804',
                    '20241129143039749141',
                    '20241129138039750351',
                    '20241129132039752343',
                    '20241129128039751987',
                    '20241129116039746636',
                    '20241129110039749872',
                    '20241129110039749872',
                    '20241128188039739266',
                    '20241128167039742586',
                    '20241128161039740094',
                    '20241128144039742313',
                    '20241128128039742705',
                    '20241128115039742264',
                    '20241127190039729204',
                    '20241127173039736598',
                    '20241127172039730394',
                    '20241127124039735052',
                    '20241127123039734120',
                    '20241127110039734241',
                    '20241126196039726978',
                    '20241126189039722723',
                    '20241126180039726585',
                    '20241126178039726263',
                    '20241126168039719442',
                    '20241126124039721098',
                    '20241126118039726468',
                    '20241126116039718122',
                    '20241125188039713396',
                    '20241125169039713316',
                    '20241125139039715499',
                    '20241125129039713097',
                    '20241125115039712797',
                    '20241125115039712797',
                    '20241125115039711910',
                    '20241125115039711910',
                    '20241125115039711910',
                    '20241122192039697760',
                    '20241122180039699664',
                    '20241122142039702045',
                    '20241122126039698879',
                    '20241122114039699762',
                    '20241121183039690601',
                    '20241121170039688844',
                    '20241121163039692148',
                    '20241121162039689280',
                    '20241121118039692768',
                    '20241120194039685294',
                    '20241120191039686214',
                    '20241120183039680094',
                    '20241120182039680158',
                    '20241120172039680921',
                    '20241120162039681024',
                    '20241120135039683936',
                    '20241120132039681128',
                    '20241120130039683406',
                    '20241119170039673176',
                    '20241119161039670692',
                    '20241119126039677136',
                    '20241119126039671492',
                    '20241119110039669005',
                    '20241118176039666530',
                    '20241118173039664527',
                    '20241118161039666665',
                    '20241118150039664459',
                    '20241118137039660143',
                    '20241115168039646613',
                    '20241115140039651591',
                    '20241115117039650093',
                    '20241114194039640491',
                    '20241114172039643232',
                    '20241114168039642531',
                    '20241114114039641076',
                    '20241113197039633616',
                    '20241113173039634088',
                    '20241113136039634911',
                    '20241113127039635097',
                    '20241113117039629875',
                    '20241113116039634990',
                    '20241112198039624269',
                    '20241112195039622591',
                    '20241112146039621516',
                    '20241112136039618511',
                    '20241112132039619106',
                    '20241112129039620401',
                    '20241109180039613168',
                    '20241108195039606190',
                    '20241108189039612247',
                    '20241108189039605425',
                    '20241108179039609916',
                    '20241108162039607877',
                    '20241107156039596678',
                    '20241106196039593300',
                    '20241106195039592521',
                    '20241106191039593423',
                    '20241106191039592658',
                    '20241106182039592607',
                    '20241106166039592449',
                    '20241106158039593128',
                    '20241106158039587742',
                    '20241106158039587742',
                    '20241106153039588029',
                    '20241106152039591373',
                    '20241106145039593162',
                    '20241106138039593015',
                    '20241106129039593241',
                    '20241106127039593105',
                    '20241106113039593366',
                    '20241106110039589400',
                    '20241105193039584206',
                    '20241105193039584104',
                    '20241105190039584370',
                    '20241105176039584670',
                    '20241105175039579450',
                    '20241105168039582424',
                    '20241105160039583970',
                    '20241105158039580150',
                    '20241105157039583794',
                    '20241105147039585646',
                    '20241105126039583854',
                    '20241105111039584496',
                    '20241105110039583905',
                    '20241105106039584987',
                    '20241101193039569448',
                    '20241101154039568314',
                    '20241031177039563820',
                    '20241031176039565502',
                    '20241031170039559990',
                    '20241031163039561992',
                    '20241031152039564168',
                    '20241031141039560909',
                    '20241031139039561680',
                    '20241031131039563004',
                    '20241031130039562421',
                    '20241031110039562107',
                    '20241030152039550123',
                    '20241030144039555922',
                    '20241030138039550617',
                    '20241030132039551058',
                    '20241029197039549380',
                    '20241029196039546377',
                    '20241029180039542718',
                    '20241029167039546581',
                    '20241029139039549263',
                    '20241029134039543550',
                    '20241029133039546532',
                    '20241029120039546482',
                    '20241029112039547017',
                    '20241028145039535400',
                    '20241025195039524768',
                    '20241025183039527198',
                    '20241025177039527241',
                    '20241025173039527207',
                    '20241025161039524649',
                    '20241025147039522607',
                    '20241025135039527203',
                    '20241024191039511261',
                    '20241024180039513487',
                    '20241024162039510215',
                    '20241024161039512424',
                    '20241024151039513905',
                    '20241024142039515740',
                    '20241024131039515738',
                    '20241024130039510836',
                    '20241024130039510836',
                    '20241024112039511026',
                    '20241023197039507103',
                    '20241022151039495001',
                    '20241021196039490497',
                    '20241021188039485866',
                    '20241021177039483429',
                    '20241021175039489326',
                    '20241021145039486981',
                    '20241021123039485169',
                    '20241018194039471501',
                    '20241018159039475596',
                    '20241018150039472784',
                    '20241018136039472684',
                    '20241017158039466846',
                    '20241017142039463200',
                    '20241017136039463214',
                    '20241016172039458003',
                    '20241016161039451968',
                    '20241016144039456166',
                    '20241015184039444916',
                    '20241015156039449235',
                    '20241015126039448615',
                    '20241011157039435536',
                    '20241011140039434989',
                    '20241010178039423623',
                    '20241010172039428047',
                    '20241010148039423536',
                    '20241010139039423378',
                    '20241009193039416639',
                    '20241009165039418865',
                    '20241009163039417854',
                    '20241009163039416988',
                    '20241009158039418878',
                    '20241009154039419350',
                    '20241009149039416125',
                    '20241009137039414802',
                    '20241009136039418758',
                    '20241009134039417320',
                    '20241009130039417511',
                    '20241009110039418012',
                    '20241008196039411210',
                    '20241008190039408479',
                    '20241008186039408354',
                    '20241008157039411813',
                    '20241008153039411755',
                    '20241008145039408245',
                    '20241008128039411145',
                    '20241007193039399646',
                    '20241007175039398684',
                    '20241007171039396468',
                    '20241007158039400109',
                    '20241007157039403674',
                    '20241007153039401212',
                    '20241007140039398363',
                    '20241007138039397965',
                    '20241007116039397867',
                    '20241005151039392358',
                    '20241005111039392547',
                    '20241004175039390413',
                    '20241004175039386079',
                    '20241004169039386925',
                    '20241004142039384921',
                    '20241004133039389394',
                    '20241004132039385215',
                    '20241004126039385488',
                    '20241004120039390447',
                    '20241004118039385565',
                    '20241003172039379790',
                    '20241003165039375100',
                    '20241003160039375766',
                    '20241003156039377752',
                    '20241003151039377746',
                    '20241003130039380444',
                    '20241003116039377967',
                    '20241003113039382676',
                    '20241002182039371814',
                    '20241002181039369237',
                    '20241002177039373862',
                    '20241002172039374301',
                    '20241002140039372326',
                    '20241002133039371604',
                    '20241002110039372230',
                    '20241001146039359307',
                    '20240930118039354195',
                    '20240927176039344643',
                    '20240925196039324039',
                    '20240925196039322929',
                    '20240925192039325614',
                    '20240925183039323171',
                    '20240925175039326420',
                    '20240925169039323636',
                    '20240925168039322314',
                    '20240925153039327082',
                    '20240925147039322217',
                    '20240925142039327288',
                    '20240925128039322515',
                    '20240925126039321820',
                    '20240924196039317377',
                    '20240924191039316894',
                    '20240924189039317866',
                    '20240924182039316562',
                    '20240924177039317530',
                    '20240924165039315058',
                    '20240924158039316117',
                    '20240924155039316311',
                    '20240924126039312561',
                    '20240924117039316922',
                    '20240924100039315743',
                    '20240923199039303127',
                    '20240923178039303542',
                    '20240923176039308160',
                    '20240923173039303692',
                    '20240923163039305557',
                    '20240923161039303419',
                    '20240923126039306680',
                    '20240923125039303322',
                    '20240923116039306952',
                    '20240921164039299702',
                    '20240921155039299052',
                    '20240920185039296215',
                    '20240920182039291014',
                    '20240920165039292855',
                    '20240920123039291234',
                    '20240920111039296109',
                    '20240919199039281871',
                    '20240919196039288478',
                    '20240919173039288230',
                    '20240919170039287692',
                    '20240919163039286741',
                    '20240919158039287417',
                    '20240919138039282033',
                    '20240919129039284775',
                    '20240919126039287175',
                    '20240918189039278868',
                    '20240918188039278653',
                    '20240918187039278063',
                    '20240918178039279998',
                    '20240918178039279009',
                    '20240918156039280142',
                    '20240918128039279391',
                    '20240918121039280754',
                    '20240918115039280723',
                    '20240918111039279482',
                    '20240917198039268539',
                    '20240917191039270318',
                    '20240917183039271946',
                    '20240917168039265683',
                    '20240917167039267311',
                    '20240917163039270562',
                    '20240917157039270811',
                    '20240917156039267100',
                    '20240917155039265261',
                    '20240917153039270495',
                    '20240917140039266812',
                    '20240917134039268005',
                    '20240917131039267897',
                    '20240917120039268435',
                    '20240917114039271122',
                    '20240916175039262278',
                    '20240916170039262505',
                    '20240916160039258218',
                    '20240916153039262545',
                    '20240916151039262434',
                    '20240916139039262371',
                    '20240916136039261226',
                    '20240916135039261353',
                    '20240916130039260664',
                    '20240916121039262182',
                    '20240916121039261975',
                    '20240916115039256750',
                    '20240916106039256603',
                    '20240913195039250644',
                    '20240913193039251088',
                    '20240913187039248627',
                    '20240913186039250324',
                    '20240913150039249581',
                    '20240913149039249787',
                    '20240913148039251163',
                    '20240912184039241122',
                    '20240912178039239098',
                    '20240912166039243157',
                    '20240912143039239759',
                    '20240912137039239760',
                    '20240912129039241022',
                    '20240912118039241492',
                    '20240912114039243188',
                    '20240911119039226987',
                    '20240910193039222749',
                    '20240909195039210228',
                    '20240909183039211083',
                    '20240909153039213613',
                    '20240909135039209713',
                    '20240909134039215072',
                    '20240907151039206680',
                    '20240906190039201569',
                    '20240906173039202053',
                    '20240906115039198709',
                    '20240905199039194795',
                    '20240905174039191304',
                    '20240905169039194735',
                    '20240905168039192735',
                    '20240903199039173903',
                    '20240903177039176962',
                    '20240903156039175300',
                    '20240903138039178691',
                    '20240902163039166400',
                    '20240902120039171683',
                    '20240831181039162364',
                    '20240831181039162364',
                    '20240831178039160522',
                    '20240831158039161723',
                    '20240829162039143218',
                    '20240828195039135644',
                    '20240828177039136163',
                    '20240822176039099215',
                    '20240814158039049756',
                    '20240813195039034249',
                    '20240805126038990403',
                    '20240802121038977083',
                    '20240723158038901685',
                    '20240717153038863452',
                    '20240716157038857044',
                    '20240716123038852497',
                    '20240715148038847516',
                    '20240715117038851203',
                    '20240711150038828708',
                    '20240710131038815694',
                    '20240709181038808786',
                    '20240709112038810856',
                    '20240705153038787555',
                    '20240705150038792039',
                    '20240703163038772593',
                    '20240703148038772922',
                    '20240702169038766075',
                    '20240702160038762262',
                    '20240630120038759677',
                    '20240628144038751624',
                    '20240626127038740134',
                    '20240625140038729532',
                    '20240625135038728683',
                    '20240625124038728924',
                    '20240621176038708167',
                    '20240620135038701791',
                    '20240619192038692806',
                    '20240618190038683237',
                    '20240618186038681143',
                    '20240618116038678888',
                    '20240617128038674851',
                    '20240617112038671509',
                    '20240613183038653162',
                    '20240611195038636541',
                    '20240611141038637111',
                    '20240607169038622028',
                    '20240607155038625513',
                    '20240605136038605124',
                    '20240605124038605281',
                    '20240604192038599067',
                    '20240604174038598992',
                    '20240604135038600348',
                    '20240526159038549936',
                    '20250205189000216058'
                );                
";
$oCon= new consulta();
$oCon->setQuery($queryAnular);
$oCon->setTipo("Multiple");
$reportesAnular = $oCon->getData();
$i = 0;
foreach ($reportesAnular as $anular) {
        $mipres= new Mipres();
        $AnularReporteFacturacion= $mipres->AnularReporteFacturacion($anular['IdFactura']);
        $AnularReporteEntrega= $mipres->AnularReporteEntrega($anular['IdReporteEntrega']);
        $AnularEntrega= $mipres->AnularEntrega($anular['IdEntrega']);
        reportarIdEntregaMipres($anular['NoPrescripcion']);
        reportarEntregaEfectivaMipres($anular['NoPrescripcion']); 
        var_dump("\n");
}



/**
 * Optiene el id de la dispensacion para el reporte de id de entrega
 */
function reportarIdEntregaMipres($prescripcion){
    $query = "SELECT  
                D.Id_Dispensacion AS \"idDis\",
                D.Codigo AS \"codDis\",
                P.Id_Paciente AS \"Id_Reclamante\",
                P.Tipo_Documento AS \"Codigo\"
		    FROM Producto_Dispensacion PD
             INNER JOIN Dispensacion D ON D.Id_Dispensacion = PD.Id_Dispensacion
             INNER JOIN Paciente P ON D.Numero_Documento = P.Id_Paciente
             INNER JOIN Producto_Dispensacion_Mipres PDM ON PDM.Id_Producto_Dispensacion_Mipres = PD.Id_Producto_Dispensacion_Mipres
             INNER JOIN Dispensacion_Mipres DM ON DM.Id_Dispensacion_Mipres = PDM.Id_Dispensacion_Mipres
             INNER JOIN Auditoria A ON A.Id_Dispensacion = D.Id_Dispensacion
             WHERE PD.Cantidad_Formulada = PD.Cantidad_Entregada AND D.Estado_Dispensacion != 'Anulada'  AND PDM.NoPrescripcion =". $prescripcion        
    ;
    $oCon= new consulta();
    $oCon->setQuery($query);
    $oCon->setTipo("Multiple");
    $dispensaciones = $oCon->getData();
    /*    echo "<h3> Reporte de Entrega MiPres para Dispensacin </h3>";
        echo "<table border='1' style='width: 100%; border-collapse: collapse; font-size: 10pt;'>";
        echo "<thead>";
        echo "<tr>";
        // 1. Datos del Producto/MiPres
        echo "<th style='padding: 5px;'>Dispensacin</th>"; // $data['ID']
        echo "<th style='padding: 5px;'>ID Mipres</th>"; // $data['ID']
        echo "<th style='padding: 5px;'>Cod SerTec Entregado</th>"; // $data['CodSerTecEntregado']
        echo "<th style='padding: 5px;'>Cant Total Entregada</th>"; // $data['CantTotEntregada']
        echo "<th style='padding: 5px;'>Lote</th>"; // $data['NoLote']
        echo "<th style='padding: 5px;'>Ent Total</th>"; // $data['EntTotal']
        echo "<th style='padding: 5px;'>Causa No Entrega</th>"; // $data['CausaNoEntrega']
        echo "<th style='padding: 5px;'>Fecha Entrega (Reporte)</th>"; // $data['FecEntrega']
        // 2. Datos del Reclamante
        echo "<th style='padding: 5px;'>Tipo ID Recibe</th>"; // $data['TipoIDRecibe']
        echo "<th style='padding: 5px;'>No ID Recibe</th>"; // $data['NoIDRecibe']
        // 3. Resultado del Reporte
        echo "<th style='padding: 5px;'>ID Entrega (Mipres)</th>"; 
        echo "<th style='padding: 5px;'>Resultado</th>";
        echo "</tr>";
        echo "</thead>";
        echo "<tbody>";
    */
    foreach ($dispensaciones as $disp) {
        //echo "\n DATOS DE LA DISPENSACION \n",json_encode($disp);
        $idDis = $disp['idDis'];
        $reclamante = array(
            'Codigo' => $disp['Codigo'],
            'Id_Reclamante' => $disp['Id_Reclamante']
        );
        /*
            echo "<tr>";
            echo "<td style='padding: 5px; text-align: center;'>{$disp['codDis']}</td>";
        */
        ValidarDispensacionMipres($idDis,$reclamante);  
    }
    /*
        echo "</tbody>";
        echo "</table>";
    */
}

/**
 * Obtiene el id de la factura para el reporte de la entrega efectiva
 */
function reportarEntregaEfectivaMipres($prescripcion){
    $query2 = "SELECT 
                    F.Id_Factura,
                    F.Codigo
                FROM Factura F 
                INNER JOIN Producto_Factura PF ON PF.Id_Factura = F.Id_Factura
                INNER JOIN Producto_Dispensacion PD ON PD.Id_Producto_Dispensacion = PF.Id_Producto_Dispensacion
                INNER JOIN Producto_Dispensacion_Mipres PDM ON PDM.Id_Producto_Dispensacion_Mipres = PD.Id_Producto_Dispensacion_Mipres
                WHERE  F.Nota_Credito IS NULL AND PDM.NoPrescripcion = ". $prescripcion."
    ";
    $oCon= new consulta();
    $oCon->setQuery($query2);
    $oCon->setTipo("Multiple");
    $facturas = $oCon->getData();
    /*
    echo "<h3>Detalle de Productos Reportados para Dispensacin ID: $factura[Id_Dispensacion] - $factura[Codigo]</h3>";
    echo "<table border='1' style='width: 100%; border-collapse: collapse;'>";
    echo "<thead>";
    echo "<tr>";
    echo "<th style='padding: 8px;'>ID Dispensacin</th>";
    echo "<th style='padding: 8px;'>ID Producto</th>";
    echo "<th style='padding: 8px;'>Estado Entrega</th>";
    echo "<th style='padding: 8px;'>Causa No Entrega</th>";
    echo "<th style='padding: 8px;'>Valor Entregado</th>";
    echo "</tr>";
    echo "</thead>";
    echo "<tbody>";*/
    foreach ($facturas as $fact) {
        /*echo "<tr>";
        echo "<td style='padding: 8px; text-align: center;'>$$fact[Codigo]</td>";*/
        ValidarDispensacionMipresFactura($fact['Id_Factura']);
    }
    /*
        echo "</tbody>";
        echo "</table>";
    */
}

//*/
/*
// var_dump("SE INICIA EL CARGAR ID \n");
$productos = $oCon->getData();
foreach ($productos as $i => $prod) {
        $data['ID']=(INT)$prod['ID'];
        $data['CodSerTecEntregado']=$prod['Cum'];
        $data['CantTotEntregada']=$prod['Entregada'];
        $data['EntTotal']=0;
        $data['CausaNoEntrega']=0;
        $data['FecEntrega']=date('Y-m-d');
        $data['NoLote']=$prod["Lote"];
        $data['TipoIDRecibe']=$reclamante['Codigo'];
        $data['NoIDRecibe']=$reclamante['Id_Reclamante'];
}

/**
 * @param mixed $prod
 * 
 * @return [type]
 */
function SaveProductosDispensacion($prod) 
{
    global $productos_no_entregados, $eventos_positiva; // se crean varibles para almacenar la informacion de productos no entregados y eventos positiva
    foreach ($prod as $p) { // se recorren los productos de la dispensacion
        $facturada = ValidarDispensacionFacturacion($p['Id_Dispensacion']); // se valida si la dispensacion esta facturada 
        if (!$facturada) { // si la dispensacion no esta facturada
            if (isset($p['Seleccionados'])) { // se valida si se seleccionaron productos
                $prod_dispensacion = GetProducto($p); // se obtienen los productos de la dispensacion
                $validacion_disponibles = validarDisponibilidadOtros($p['Seleccionados'], $prod_dispensacion); 
                if ($validacion_disponibles && $prod_dispensacion['Id_Producto_Dispensacion']) {

                    $inventario = new complex("Inventario_Nuevo", "Id_Inventario_Nuevo", $validacion_disponibles['Id_Inventario_Nuevo']);
                    $inventario = $inventario->getData();
                    $oItem = new complex("Producto_Dispensacion", "Id_Producto_Dispensacion", $p['Id_Producto_Dispensacion']);

                    $oItem->Cantidad_Entregada = $prod_dispensacion['Cantidad_Entregada'] + $p['Cantidad_Entregada'];
                    $oItem->Lote = $validacion_disponibles['Lote'];
                    // $oItem->Fecha_Vencimiento = $inventario['Fecha_Vencimiento'];
                    $oItem->Id_Inventario_Nuevo = $validacion_disponibles['Id_Inventario_Nuevo'];
                    $oItem->Cum = $p['Codigo_Cum'];
                    $oItem->Id_Producto = $p['Id_Producto'];
                    $oItem->Costo = number_format($p['Costo'], 2, ".", "");

                    $oItem->Id_Inventario_Nuevo_Seleccionados = armarJsonEntregados($p, $prod_dispensacion, $p['Seleccionados']);

                    foreach ($p['Seleccionados'] as $lote) {

                        descontarCantidadesInventario($lote);
                    }
                    SaveActa($p['Id_Dispensacion']);
                    $eventos_positiva[] = GuardarActividad($p);
                    RegistarCambioProducto($p);
                    $oItem->save();
                    unset($oItem);
                    unset($inventario);
                } else {
                    $productos_no_entregados[] = $p;
                }
            } else if (validarEntregaProducto($p["Cantidad_Entregada"], $p['Id_Inventario_Nuevo'])) { // se valida si la cantidad entregada es valida
                $prod_disp = GetProducto($p); // se obtienen los productos de la dispensacion
                if ($prod_disp['Id_Producto_Dispensacion']) {
                    $p['Id_Producto'] = isset($p['Id_Producto_Antiguo']) ? $p['Id_Producto'] : $p['Id_Producto'];
                    $id_producto_pendiente = null;
                    $pd = new complex("Producto_Dispensacion", "Id_Producto_Dispensacion", $p['Id_Producto_Dispensacion']);
                    $pd->Cantidad_Entregada = $prod_disp['Cantidad_Entregada'] + $p['Cantidad_Entregada'];
                    $pd->Lote = $prod_disp['Lote'] !== 'Pendiente' || $prod_disp['Lote'] !== '' ? $p['Lote'] : $prod_disp['Lote'];
                    // $pd->Fecha_Vencimiento = $prod_disp['Fecha_Vencimiento'] !== '' ? $p['Fecha_Vencimiento'] : $prod_disp['Fecha_Vencimiento'];
                    $pd->Id_Inventario_Nuevo = ($prod_disp['Id_Inventario_Nuevo'] !== '' && $prod_disp['Id_Inventario_Nuevo'] != '0') ? $prod_disp['Id_Inventario_Nuevo'] : $p['Id_Inventario_Nuevo'];
                    $pd->Id_Inventario_Nuevo_Seleccionados = armarJsonEntregados($p, $prod_disp);
                    $pd->Cum = $p['Codigo_Cum'];
                    $pd->Id_Producto = $p['Id_Producto'];
                    $pd->Costo = number_format($p['Costo'], 2, ".", "");
                    $pd->save();
                    $id_producto_pendiente = $pd->getId();
                    unset($pd);

                    $oItem = new complex('Producto_Dispensacion_Pendiente', "Id_Producto_Dispensacion_Pendiente");
                    $cantidad_pendiente = $p["Cantidad_Formulada"] - $p["Cantidad_Entregada"];
                    $oItem->Id_Producto_Dispensacion = $id_producto_pendiente;
                    $oItem->Cantidad_Entregada = $p["Cantidad_Entregada"];
                    $oItem->Cantidad_Pendiente = $cantidad_pendiente;
                    $oItem->Entregar_Faltante = $cantidad_pendiente;

                    $oItem->save();
                    unset($oItem);

                    if ($p["Id_Inventario_Nuevo"] != "0") {
                        descontarCantidadesInventario($p);
                    }
                    SaveActa($p['Id_Dispensacion']);
                    $eventos_positiva[] = GuardarActividad($p);
                    RegistarCambioProducto($p);
                }
            } else {
                $productos_no_entregados[] = $p;
            }
        } else {
            $productos_no_entregados[] = $p;
        }

        if (isset($p['Id_Producto_Dispensacion_Mipres']) && $p['Id_Producto_Dispensacion_Mipres'] != '') {
            updateProductoDispensacionMipres($p['Id_Producto_Dispensacion_Mipres'], $p['Id_Producto']);
        }
        DescontarPendientes($p['Id_Dispensacion'], 0);
    }
}

function descontarCantidadesInventario($p)
{

    if ($p["Id_Inventario_Nuevo"] != "0") {
        $p['Id_Inventario_Nuevo'] = (int) $p['Id_Inventario_Nuevo'];
        $oItem = new complex('Inventario_Nuevo', "Id_Inventario_Nuevo", $p['Id_Inventario_Nuevo']);
        $inv_act = $oItem->getData();
        $cantidad = number_format((int) $inv_act["Cantidad"], 0, "", "");
        $cantidad_entregada = number_format($p["Cantidad_Entregada"], 0, "", "");
        $cantidad_total = $cantidad - $cantidad_entregada;
        if ($cantidad_total < 0) {
            $cantidad_total = 0;
            $p['Cantidad_Entregada'] = $cantidad;
            $p['Entregar_Faltante'] = $cantidad_entregada - $cantidad;
        }
        $oItem->Cantidad = number_format($cantidad_total, 0, "", "");
        $oItem->save();
        unset($oItem);
    }
}

function armarJsonEntregados($prod, $prod_ant, $array_entrega_multiple = [])
{
    $entregados = (array) json_decode($prod_ant['Id_Inventario_Nuevo_Seleccionados'], true);

    if (count($entregados) == 0) {
        if ($prod_ant['Cantidad_Entregada'] > 0) {
            $entrega_ant = array('Id_Inventario_Nuevo' => $prod_ant['Id_Inventario_Nuevo'], 'Lote' => $prod_ant['Lote'], 'Cantidad_Entregada' => $prod_ant['Cantidad_Entregada']);
            array_push($entregados, $entrega_ant);
        }
    }

    if (count($array_entrega_multiple) == 0) {
        if ($prod_ant['Cantidad_Entregada'] > 0) {
            $entrega = array('Id_Inventario_Nuevo' => $prod['Id_Inventario_Nuevo'], 'Lote' => $prod['Lote'], 'Cantidad_Entregada' => $prod['Cantidad_Entregada']);
            array_push($entregados, $entrega);
        }
    } else {

        foreach ($array_entrega_multiple as $lote) {

            array_push($entregados, $lote);
        }
    }

    return json_encode($entregados);
}

function validarDisponibilidadOtros($lotes_seleccionados, $entrega_ant)
{
    $disponibles = true;
    $max_seleccionado = (int) $entrega_ant['Cantidad_Entregada'];
    $validacion['Lote'] = $entrega_ant['Lote'];
    $validacion['Id_Inventario_Nuevo'] = $entrega_ant['Id_Inventario_Nuevo'];
    foreach ($lotes_seleccionados as $s) {
        if (!validarEntregaProducto($s['Cantidad_Entregada'], $s['Id_Inventario_Nuevo'])) {
            $disponibles = false;
        }
        if ($s['Cantidad_Entregada'] > $max_seleccionado) {
            $validacion['Lote'] = $s['Lote'];
            $validacion['Id_Inventario_Nuevo'] = $s['Id_Inventario_Nuevo'];
            $max_seleccionado = $s['Cantidad_Entregada'];
        }
    }

    $validacion['disponibles'] = $disponibles;
    if (!$disponibles) {
        $validacion = false;
    }

    return $validacion;
}

/**
 * Obtiene la cantidad disponible de inventario nuevo
 * @param mixed $id_inventario_nuevo
 * 
 * @return [type]
 */
function cantidadInventario($id_inventario_nuevo)
{

    $query = "SELECT (Cantidad-Cantidad_Apartada-Cantidad_Seleccionada) AS Cantidad FROM Inventario_Nuevo WHERE Id_Inventario_Nuevo = $id_inventario_nuevo"; // se crea la query para obtener la cantidad disponible en el inventario nuevo
    $oCon = new consulta(); // se crea el objeto consulta
    $oCon->setQuery($query); // se le pasa el query al objeto de consulta
    $cantidad = $oCon->getData()['Cantidad']; // se ejecuta la consulta y se guarda el resultado en la variable cantidad
    unset($oCon); // se destruye el objeto consulta
    return $cantidad; // se retorna la cantidad
}

/**
 * valida que la cantidad entregada sea valida
 * @param mixed $cant_entrega
 * @param mixed $id_inventario_nuevo
 * 
 * @return bool
 */
function validarEntregaProducto($cant_entrega, $id_inventario_nuevo)
{

    $cantidad_inventario_nuevo = cantidadInventario($id_inventario_nuevo); //
    if (($cantidad_inventario_nuevo - $cant_entrega) >= 0) {
        return true;
    }
    return false;
}

function GuardarActividad($dis)
{
    global $modelo, $_FILES;

    $query = "SELECT PD.Nombre from Punto_Dispensacion PD INNER JOIN Estiba E on E.Id_Punto_Dispensacion = PD.Id_Punto_Dispensacion
                INNER JOIN Inventario_Nuevo I on I.Id_Estiba = E.Id_Estiba
                WHERE I.Id_Inventario_Nuevo = $dis[Id_Inventario_Nuevo]";

    $oCon = new consulta();
    $oCon->setQuery($query);
    $punto = $oCon->getData()['Nombre'];
    unset($oCon);

    if ($dis["Cantidad_Entregada"] > 0) {
        $ActividadDis['Fecha'] = date("Y-m-d H:i:s");
        $ActividadDis["Id_Dispensacion"] = $dis['Id_Dispensacion'];
        $ActividadDis["Identificacion_Funcionario"] = $modelo['Identificacion_Funcionario'];
        $ActividadDis["Detalle"] = "Se entrego la dispensacion pendiente. Producto: $dis[Nombre_Comercial] - Cantidad: $dis[Cantidad_Entregada] - punto: $punto";
        $ActividadDis["Estado"] = "Creado";

        $oItem = new complex("Actividades_Dispensacion", "Id_Actividades_Dispensacion");
        foreach ($ActividadDis as $index => $value) {
            $oItem->$index = $value;
        }
        $oItem->save();
        unset($oItem);
        $evento = null;
        /*
        // !SE INACTIVA LA INTEGRACION CON POSITIVA POR TERMINACION DEL CONTRATO
        $acta_entrega = ValidarActaEntrega($dis['Id_Dispensacion']);
        $evento = $acta_entrega? EnviarEventoPositiva($dis, $acta_entrega): null;
        */
        return ($evento);
    }
}
function SaveFirma($imagen)
{

    global $MY_FILE;

    list($type, $imagen) = explode(';', $imagen);
    list(, $imagen) = explode(',', $imagen);
    $imagen = base64_decode($imagen);

    $fot = "firma" . uniqid() . ".jpg";
    $archi = $MY_FILE . "IMAGENES/FIRMAS-DIS/" . $fot;
    file_put_contents($archi, $imagen);
    chmod($archi, 0644);
    return $fot;
}
function SaveActa($id_disp)
{
    global $nombre_archivo;

    if ($nombre_archivo && $nombre_archivo != '') {
        $oItem = new complex('Dispensacion', 'Id_Dispensacion', $id_disp);
        $oItem->Acta_Entrega = $nombre_archivo;
        $oItem->save();
        unset($oItem);
    }
}

function DescontarPendientes($dis, $cantidad)
{

    $query = "UPDATE Dispensacion D INNER JOIN Producto_Dispensacion PD ON PD.Id_Dispensacion = D.Id_Dispensacion
    SET D.Pendientes = (SELECT SUM(PD2.Cantidad_Formulada - PD2.Cantidad_Entregada)FROM Producto_Dispensacion PD2 Where PD2.Id_Dispensacion = D.Id_Dispensacion) WHERE D.Id_Dispensacion = $dis   ";

    $oItem = new consulta();
    $oItem->setQuery($query);
    $oItem->getData();
    unset($oItem);
}

/**
 * obtiene el producto pendiente de la dispensacion
 * 
 * @param mixed $prod
 * 
 * @return object
 */
function GetProducto($prod)
{

    global $queryObj;
    
    $id_producto = isset($prod['Id_Producto_Antiguo']) ? $prod['Id_Producto_Antiguo'] : $prod['Id_Producto'];
    $query = "SELECT *,(Cantidad_Formulada-Cantidad_Entregada) as Cantidad_Pendiente
                FROM Producto_Dispensacion
                WHERE Id_Dispensacion=$prod[Id_Dispensacion]
                AND Id_Producto=$id_producto
                HAVING Cantidad_Pendiente>0 ";
    $queryObj->SetQuery($query);
    $pd = $queryObj->ExecuteQuery('simple');
    return $pd;
}

function getStatus()
{

    global $productos_no_entregados;

    if (count($productos_no_entregados) > 0) {
        return 1;
    } else {
        return 2;
    }
}

function RegistarCambioProducto($p)
{

    global $modelo;

    if (isset($p['Id_Producto_Antiguo'])) {
        $oItem = new complex("Cambio_Producto_Dispensacion", "Id_Cambio_Producto_Dispensacion");
        $oItem->Id_Producto_Nuevo = $p['Id_Producto'];
        $oItem->Id_Producto_Antiguo = $p['Id_Producto_Antiguo'];
        $oItem->Id_Dispensacion = $p['Id_Dispensacion'];
        $oItem->Identificacion_Funcionario = $modelo['Identificacion_Funcionario'];
        $oItem->save();
        unset($oItem);
    }
}
function GuardarDispensacionPortalClientes($idDis)
{
    global $portalClientes;

    $response = $portalClientes->ActualizarDispensacion($idDis);
}
/**
 * valida que la dispensacion este facturada
 * 
 * @param mixed $idDis
 * 
 * @return object
 */
function ValidarDispensacionFacturacion($idDis)
{
    global $queryObj; // variable global de conexion a la base de datos
    $query = "SELECT * FROM Dispensacion D Where D.Id_Dispensacion = $idDis and D.Estado_Facturacion = 'Facturada' "; // consulta a la base de datos: trae si una dispensacion esta facturada
    $queryObj->SetQuery($query);// se ejecuta la consulta
    $productos_sin_precio = $queryObj->ExecuteQuery('simple'); // se almacena el resultado de la consulta en la variable productos_sin_precio
    return $productos_sin_precio; // se retorna la variable productos_sin_precio
}

function GetProductosSinPrecio($dispensacion, $idDis)
{
    global $queryObj;

    if (strtolower($dispensacion['Tipo_Servicio']) == "evento") {
        $exits = " AND NOT exists (SELECT Codigo_Cum FROM Producto_Evento WHERE Codigo_Cum=P.Codigo_Cum AND Nit_EPS=$dispensacion[Id_Cliente] AND Precio>0 )  ";
    } elseif (strtolower($dispensacion['Tipo_Servicio']) == 'cohortes') {
        $exits = " AND NOT exists (SELECT Id_Producto FROM Producto_Cohorte WHERE Id_Producto=PD.Id_Producto AND Nit_EPS=$dispensacion[Id_Cliente] ) ";
    }

    $query = "SELECT PD.Id_Producto,P.Nombre_Comercial,P.Codigo_Cum, IFNULL((SELECT Precio FROM Precio_Regulado WHERE Codigo_Cum=P.Codigo_Cum),0) as Precio, CONCAT(P.Principio_Activo,' ',P.Presentacion,' ',P.Concentracion,' ', P.Cantidad,' ', P.Unidad_Medida) as Nombre
    FROM Producto_Dispensacion PD
    INNER JOIN Producto P ON PD.Id_Producto=P.Id_Producto
    WHERE PD.Id_Dispensacion=$idDis " . $exits . " GROUP BY PD.Id_Producto HAVING Precio=0 ";

    $queryObj->SetQuery($query);
    $productos_sin_precio = $queryObj->ExecuteQuery('Multiple');

    return $productos_sin_precio;
}

function GetIdFactura($idDis)
{
    global $queryObj;
    $query = "SELECT Id_Factura FROM Factura WHERE Id_Dispensacion=$idDis";
    $queryObj->SetQuery($query);
    $fact = $queryObj->ExecuteQuery('simple');
    return $fact['Id_Factura'];
}

function GetTotalFactura($id)
{
    global $queryObj;
    $query = "SELECT SUM(Subtotal) as Total FROM Producto_Factura WHERE Id_Factura=$id";
    $queryObj->SetQuery($query);
    $fact = $queryObj->ExecuteQuery('simple');
    return $fact['Total'];
}

function ValidarDispensacionMipres($idDis,$reclamante)
{
    //var_dump($reclamante);
    global $queryObj, $mipres /*$reclamante*/;
    $productos = GetProductosDispensacionMipres($idDis);


    foreach ($productos as $prod) {
    //var_dump("\n DATOS DE LA DISPENSACION",$prod, " FIN DE LOS DATOS DISPENSACION \n   ");
        $data['ID'] = (int) $prod['ID'];
        $data['CodSerTecEntregado'] = ($prod["Tipo_Tecnologia"]=="M" ? $prod['Cum'] : $prod['CodSerTecAEntregar']);
        $data['CantTotEntregada'] = $prod['Entregada'];
        $data['EntTotal'] = 1;
        $data['CausaNoEntrega'] = 0;
        // Crear objeto DateTime
        /**
         * se opera con la fecha de entrega de la dispensacion si la fecha de entrega de la dispensacion es mayor a la fecha maxima de entrega
         * se usa la fecha maxima de entrega
         */
        $dt = new DateTime($prod["Fecha"]); // Fecha de entrega de la dispensacion
        $dtm = new DateTime($prod["FechaMaxEntrega"]); // fecha maxima de entrega
        if($dt>$dtm){ //validacion para saber si la fecha de entrega de la dispensacion es mayor a la fecha maxima de entrega
            $dt = new DateTime($prod["FechaMaxEntrega"]); // se usa la fecha maxima de entrega si la fecha de entrega de la dispensacion es mayor a la fecha maxima de entrega
        }
        // Formatear a ISO 8601 con T
        $fecha_iso = $dt->format('Y-m-d');

        // Guardar en el array de envo
        $data["FecEntrega"] = $fecha_iso;

        $data['NoLote'] = $prod["Lote"];
        $data['TipoIDRecibe'] = $reclamante['Codigo'];
        $data['NoIDRecibe'] = $reclamante['Id_Reclamante'];

        $mipres= new Mipres();
        $entrega = $mipres->ReportarEntrega($data);

        /*
            echo "<td style='padding: 5px; text-align: center;'>{$data['ID']}</td>";
            echo "<td style='padding: 5px;'>{$data['CodSerTecEntregado']}</td>";
            echo "<td style='padding: 5px; text-align: center;'>{$data['CantTotEntregada']}</td>";
            echo "<td style='padding: 5px;'>{$data['NoLote']}</td>";
            echo "<td style='padding: 5px; text-align: center;'>{$data['EntTotal']}</td>";
            echo "<td style='padding: 5px; text-align: center;'>{$data['CausaNoEntrega']}</td>";
            echo "<td style='padding: 5px; text-align: center;'>{$data['FecEntrega']}</td>";
            echo "<td style='padding: 5px; text-align: center;'>{$data['TipoIDRecibe']}</td>";
            echo "<td style='padding: 5px;'>{$data['NoIDRecibe']}</td>";
        */
        if ($entrega[0]['Id']) {
            var_dump("se reporta ReportarEntrega ", $entrega[0]['IdEntrega']);
            $oItem = new complex('Producto_Dispensacion_Mipres', 'Id_Producto_Dispensacion_Mipres', $prod['Id_Producto_Dispensacion_Mipres']);
            $oItem->IdEntrega = $entrega[0]['IdEntrega'];
            $oItem->Fecha_Entrega = date("Y-m-d H:i:s");
            $oItem->save();
            unset($oItem);
            
            $oItem = new complex('Dispensacion_Mipres', 'Id_Dispensacion_Mipres', $prod['Id_Dispensacion_Mipres']);
            $oItem->Estado = 'Entregado';
            $oItem->save();
            unset($oItem);

            // $idEntrega = $entrega[0]['IdEntrega'];
            // $resultado = "$entrega[0]['Mensaje']";
           // echo "<td style='padding: 5px; text-align: center;'>$idEntrega</td>";
            //echo "<td style='padding: 5px; text-align: center; color: " . ($idEntrega !== 'N/A' ? 'green' : 'red') . ";'>$resultado</td>";
            
            
        }
        else {
            var_dump("no se reporta ReportarEntrega ");
            // $idEntrega = $entrega[0]['IdEntrega'];
            // $resultado = $entrega["Errors"][0];
            //echo "<td style='padding: 5px; text-align: center;'>$idEntrega</td>";
            //echo "<td style='padding: 5px; text-align: center; color: " . ($idEntrega !== 'N/A' ? 'green' : 'red') . ";'>$resultado</td>";
        }
        //echo "</tr>";
        // Impresin de la fila
       // GuardarDatosReclamante($reclamante);
    }
    /*
    if (count($productos) == 0) {
        $oItem = new complex('Dispensacion_Mipres', 'Id_Dispensacion_Mipres', $idDis);
        $oItem->Estado = 'Radicado Programado';
        $oItem->save();
        unset($oItem);
    }*/
}

  function ValidarDispensacionMipresFactura($idFactura){
    global $mipres;
    
    $query="SELECT * FROm Factura WHERE Id_Factura=$idFactura";

    $oCon = new consulta();
    $oCon->setQuery($query);
    $factura = $oCon->getData();
    unset($oCon);


    $mipres = new Mipres();
    $query="SELECT Id_Dispensacion_Mipres, Id_Dispensacion From Dispensacion WHERE Id_Dispensacion=$factura[Id_Dispensacion] ";

    
    $oCon = new consulta();
    $oCon->setQuery($query);
    $dispensacion = $oCon->getData();
    unset($oCon); 
    $productos_mipres=GetProductosMipres($dispensacion['Id_Dispensacion_Mipres']);

    foreach ($productos_mipres as $p) { 
       $subtotalProducto=GetSubtotalProducto($p['Id_Producto'],$idFactura, $dispensacion['Id_Dispensacion_Mipres']);
       $data['ID']=(INT)$p['ID'];
       $data['EstadoEntrega']=1;
       $data['CausaNoEntrega']=0;
       $data['ValorEntregado']= $subtotalProducto;
       // INICIO: Aqu se crea la fila de la tabla con los datos
        /*
        echo "<td style='padding: 8px; text-align: center;'>{$data['ID']}</td>";
        echo "<td style='padding: 8px; text-align: center;'>{$data['EstadoEntrega']}</td>";
        echo "<td style='padding: 8px; text-align: center;'>{$data['CausaNoEntrega']}</td>";
        echo "<td style='padding: 8px; text-align: right;'>\$" . number_format($data['ValorEntregado'], 2, ',', '.') . "</td>";
        echo "</tr>";*/
        // FIN: Fila de la tabla
       
       $respuesta=$mipres->ReportarEntregaEfectiva($data);
       
       if($respuesta[0]['Id']){
            var_dump("se ReportarEntregaEfectiva ",$respuesta[0]['IdReporteEntrega']);
            $oItem=new complex('Producto_Dispensacion_Mipres','Id_Producto_Dispensacion_Mipres',$p['Id_Producto_Dispensacion_Mipres']);
            $oItem->IdReporteEntrega=$respuesta[0]['IdReporteEntrega'];
            $oItem->save();
            unset($oItem);
        }
        else{
            var_dump("no se ReportarEntregaEfectiva");
        }
    }
}


function GetSubtotalProducto($idProducto,$idFactura,$id_mipres){

    // original
    // $query="SELECT PD.Id_Producto FROM Dispensacion D INNER JOIN Producto_Dispensacion PD ON D.Id_Dispensacion=PD.Id_Dispensacion WHERE D.Id_Dispeensacion_Mipres=$id_mipres AND PD.Id_Producto_Mipres= $idProducto ";
    // correccion 15-01-2020
    $query="SELECT PD.Id_Producto 
    FROM Dispensacion D 
    INNER JOIN Producto_Dispensacion PD ON D.Id_Dispensacion=PD.Id_Dispensacion 
    WHERE D.Id_Dispensacion_Mipres=$id_mipres 
    AND PD.Id_Producto_Mipres= $idProducto ";
    
    $oCon = new consulta();
    $oCon->setQuery($query);
    $prod = $oCon->getData();

    if(isset($prod['Id_Producto']) && $prod['Id_Producto']!=''){
        $query="SELECT SUM(Cantidad*Precio) + SUM((Cantidad*Precio)*(Impuesto/100)) as Subtotal From Producto_Factura  WHERE Id_Factura=$idFactura AND Id_Producto=$prod[Id_Producto] ";
        $oCon = new consulta();
        $oCon->setQuery($query);
        $subt = $oCon->getData();
        unset($oCon);
        return (FLOAT)$subt['Subtotal'];
    }else{
        return 0;
    }
}


function GetProductosDispensacionMipres($id_dis)
{
    global $queryObj;
    $query = 'SELECT 
                   SUM(PD.Cantidad_Formulada) AS Formulada, 
                   SUM(PD.Cantidad_Entregada) AS Entregada, 
                   D.Fecha_Actual AS Fecha, 
                   DM.Fecha_Maxima_Entrega AS FechaMaxEntrega, 
                   PDM.ID,
                   PDM.CodSerTecAEntregar,
                   PDM.Tipo_Tecnologia, 
                   PD.Id_Dispensacion, 
                   PD.Cum, 
                   PD.Lote, 
                   PDM.Id_Producto_Dispensacion_Mipres, 
                   PDM.Id_Dispensacion_Mipres,
                   PDM.IdFactura,
                   PDM.IdReporteEntrega,
                   PDM.IdEntrega
             FROM Producto_Dispensacion PD
             INNER JOIN Dispensacion D ON D.Id_Dispensacion = PD.Id_Dispensacion
             INNER JOIN Producto_Dispensacion_Mipres PDM ON PDM.Id_Producto_Dispensacion_Mipres = PD.Id_Producto_Dispensacion_Mipres
             INNER JOIN Dispensacion_Mipres DM ON DM.Id_Dispensacion_Mipres = PDM.Id_Dispensacion_Mipres
             INNER JOIN Auditoria A ON A.Id_Dispensacion = D.Id_Dispensacion
             WHERE PD.Id_Dispensacion='. $id_dis .'
             AND D.Estado_Dispensacion != "Anulada"
             GROUP BY PD.Id_Producto_Dispensacion_Mipres
             HAVING Entregada = Formulada';
        $queryObj->SetQuery($query);
        $productos = $queryObj->ExecuteQuery('Multiple');
        //var_dump($query);
    return $productos;
}

function GetPendientes($idDis)
{

    global $queryObj;

    $query = "SELECT PD.Id_Dispensacion,PD.Id_Producto,(SELECT Codigo FROM Dispensacion WHERE Id_Dispensacion=PD.Id_Dispensacion) as Codigo, CONCAT(P.Principio_Activo,' ',P.Presentacion,' ',P.Concentracion,' ', P.Cantidad,' ', P.Unidad_Medida) as Nombre,P.Nombre_Comercial,P.Codigo_Cum
    FROM Producto_Dispensacion PD
    INNER JOIN Producto P ON PD.Id_Producto=P.Id_Producto
    WHERE PD.Id_Dispensacion=$idDis AND PD.Cantidad_Formulada !=PD.Cantidad_Entregada";
    $queryObj->SetQuery($query);
    $pendientes = $queryObj->ExecuteQuery('Multiple');

    return $pendientes;
}

function GetDispensacion($idDis)
{
    global $queryObj;

    $query = "SELECT Id_Dispensacion_Mipres,Id_Dispensacion,Id_Tipo_Servicio FROM Dispensacion WHERE Id_Dispensacion=$idDis";
    $queryObj->SetQuery($query);
    $dispensacion = $queryObj->ExecuteQuery('simple');
    return $dispensacion;
}

function GetProductosMipres($idMipres){

    $query="SELECT * From Producto_Dispensacion_Mipres WHERE Id_Dispensacion_Mipres=$idMipres ";
    
    $oCon = new consulta();
    $oCon->setQuery($query);
    $oCon->setTipo('Multiple');
    $productos = $oCon->getData();
    unset($oCon);
    return $productos;
}

function GetCodigoSede()
{

    global $queryObj;
    $query = 'SELECT Codigo_Sede	 FROM Configuracion WHERE Id_Configuracion=1';
    $queryObj->SetQuery($query);
    $dato = $queryObj->ExecuteQuery('simple');
    return $dato['Codigo_Sede'];
}

function GetNitProh()
{

    global $queryObj;

    $query = 'SELECT NIT FROM Configuracion WHERE Id_Configuracion=1';
    $queryObj->SetQuery($query);
    $dato = $queryObj->ExecuteQuery('simple');
    $n = explode('-', $dato['NIT']);
    $nit = $n[0];
    $nit = str_replace('.', '', $nit);
    return $nit;
}

function GetLoteEntregado($idProducto, $idDis)
{

    global $queryObj;
    $query = "SELECT Lote From Producto_Dispensacion WHERE Id_Producto_Mipres=$idProducto AND Id_Dispensacion=$idDis ";
    $queryObj->SetQuery($query);
    $lote = $queryObj->ExecuteQuery('simple');
    return $lote['Lote'];
}

function updateProductoDispensacionMipres($id_producto_mipres, $id_producto)
{
    $oItem = new complex('Producto_Dispensacion_Mipres', 'Id_Producto_Dispensacion_Mipres', $id_producto_mipres);
    $oItem->Id_Producto = $id_producto;
    $oItem->save();
    unset($oItem);
}

function GuardarDatosReclamante($reclamante)
{

    global $queryObj;

    if ($reclamante['Id_Reclamante']) {
        $query = "SELECT * FROM Reclamante WHERE Id_Reclamante=$reclamante[Id_Reclamante]";
        $queryObj->SetQuery($query);
        $usuario = $queryObj->ExecuteQuery('simple');
    } else {

        $usuario = true;
    }
    $oItem = new complex('Reclamante', 'Id_Reclamante', (!$usuario) ? 0 : $usuario['Id_Reclamante']);

    $oItem->Nombre = $reclamante['Nombre'];

    $oItem->Id_Reclamante = $reclamante['Id_Reclamante'];

    $oItem->Tipo_Doc = $reclamante['Codigo'];

    $oItem->save();

    unset($oItem);

    addReclamanteToDispensacion($reclamante);
}

/**
 * Se crea funcion para asociar reclamante a la dispensacion actual, esta relacion se guarda en la tabla dispensacion_reclamante
 */

function addReclamanteToDispensacion($reclamante)
{
    global $modelo, $queryObj;

    $parentesco = $reclamante['parentesco'];

    $Id_Reclamante = $reclamante['Id_Reclamante'];

    $Id_Dispensacion = GetDispensacion($modelo['Id_Dispensacion'])['Id_Dispensacion'];

    if ($Id_Reclamante != '' && $Id_Dispensacion != '') {

        $query = "SELECT * FROM Dispensacion_Reclamante WHERE Dispensacion_Id = '$Id_Dispensacion' ";
        $queryObj->SetQuery($query);
        $reclamante = $queryObj->ExecuteQuery('simple');

        $oItem = new complex('Dispensacion_Reclamante', 'Id', ($reclamante == null || $reclamante == 'null') ? 0 : $reclamante['Id']);

        $oItem->Reclamante_Id = $Id_Reclamante;

        $oItem->Dispensacion_Id = $Id_Dispensacion;

        $oItem->Parentesco = $parentesco;

        $oItem->save();

        unset($oItem);

        return;
    }
}
function ValidarActaEntrega($id_dis)
{
    $oItem = new complex('Dispensacion', 'Id_Dispensacion', $id_dis);
    $dis = $oItem->getData();

    if($dis){
        $ruta= $dis['Acta_Entrega'];
        $row['name'] = pathinfo($ruta, PATHINFO_BASENAME);
        $row['type'] = "application/".pathinfo($ruta, PATHINFO_EXTENSION);
        $row['tmp_name'] = $ruta; 
        return $row;
    }

}

function EnviarEventoPositiva($producto, $soporte)
{
    global $queryObj, $modelo;

    $query = "SELECT PD.numeroAutorizacion
                from Positiva_Data PD
                    Where PD.Id_Dispensacion = $producto[Id_Dispensacion] "; 


    $queryObj->SetQuery($query);
    $autorizacion = $queryObj->ExecuteQuery('simple');

    $acta_entrega['files']=$soporte;
    if($autorizacion['numeroAutorizacion'] && $acta_entrega['files']['name']){
        $positiva = new Fase2($autorizacion['numeroAutorizacion'], $acta_entrega, $producto['Cantidad_Entregada'], null, 'Entrega exitosa', 'SE', $modelo['Identificacion_Funcionario']);
        $rta = $positiva->Enviar();
    }
    return $rta;
}
