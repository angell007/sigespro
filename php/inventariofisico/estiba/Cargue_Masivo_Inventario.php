<?php
	header('Access-Control-Allow-Origin: *');
	header('Access-Control-Allow-Headers: Origin, Content-Type, X-Auth-Token');
	header('Content-Type: application/json');

	date_default_timezone_set('America/Bogota');

	//require_once('../../config/start.inc.php');
	include_once('../../../class/class.querybasedatos.php');
	include_once('../../../class/class.paginacion.php');
	include_once('../../../class/class.http_response.php');
    include_once('../../../class/class.utility.php');

   //$productos = ( isset( $_REQUEST['Productos'] ) ? $_REQUEST['Productos'] : '' );
	
	$productos = '[ { "Codigo_Cum": "VITAL NO DISP", "Codigo_Barras": "7709768067463", "Lote": "GT2130", "Fecha_Vencimiento": "2027-09-01", "Cantidad": 100 }, { "Codigo_Cum": "54973-7", "Codigo_Barras": "7702195107870", "Lote": 620805, "Fecha_Vencimiento": "2027-03-01", "Cantidad": 40 }, { "Codigo_Cum": "53916-9", "Codigo_Barras": "7707355053103", "Lote": 2170125, "Fecha_Vencimiento": "2027-01-01", "Cantidad": 120 }, { "Codigo_Cum": "50728-2", "Codigo_Barras": "7707035511770", "Lote": 2401026, "Fecha_Vencimiento": "2027-05-01", "Cantidad": 250 }, { "Codigo_Cum": "48012-1", "Codigo_Barras": "7702605184453", "Lote": "F00241A", "Fecha_Vencimiento": "2027-02-01", "Cantidad": 660 }, { "Codigo_Cum": "47458-9", "Codigo_Barras": "7707355056616", "Lote": 22811124, "Fecha_Vencimiento": "2026-11-01", "Cantidad": 100 }, { "Codigo_Cum": "47203-3", "Codigo_Barras": "7707035511251", "Lote": 2401020, "Fecha_Vencimiento": "2026-05-01", "Cantidad": 6 }, { "Codigo_Cum": "44969-9", "Codigo_Barras": "7703038066033", "Lote": 96404, "Fecha_Vencimiento": "2027-02-01", "Cantidad": 60 }, { "Codigo_Cum": "44405-3", "Codigo_Barras": "7702195547188", "Lote": "624B20", "Fecha_Vencimiento": "2026-08-01", "Cantidad": 40 }, { "Codigo_Cum": "43493-6", "Codigo_Barras": "7702184693353", "Lote": "E101073", "Fecha_Vencimiento": "2026-11-01", "Cantidad": 240 }, { "Codigo_Cum": "41072-10", "Codigo_Barras": "7709071926785", "Lote": "B5B007", "Fecha_Vencimiento": "2027-02-01", "Cantidad": 870 }, { "Codigo_Cum": "36324-3", "Codigo_Barras": "7702195322341", "Lote": "632C01", "Fecha_Vencimiento": "2028-01-01", "Cantidad": 40 }, { "Codigo_Cum": "35662-11", "Codigo_Barras": "7702184012697", "Lote": "E070457", "Fecha_Vencimiento": "2026-07-01", "Cantidad": 820 }, { "Codigo_Cum": "34537-2", "Codigo_Barras": "7702184041130", "Lote": "FD40543", "Fecha_Vencimiento": "2027-04-01", "Cantidad": 72 }, { "Codigo_Cum": "32897-22", "Codigo_Barras": "7702184011003", "Lote": "E110136", "Fecha_Vencimiento": "2027-11-01", "Cantidad": 1460 }, { "Codigo_Cum": "31190-3", "Codigo_Barras": "7702605185269", "Lote": "F00131A", "Fecha_Vencimiento": "2028-01-01", "Cantidad": 150 }, { "Codigo_Cum": "30970-6", "Codigo_Barras": "7707355054834", "Lote": 23711124, "Fecha_Vencimiento": "2026-11-01", "Cantidad": 40 }, { "Codigo_Cum": "23440-10", "Codigo_Barras": "7702184010969", "Lote": "F010938", "Fecha_Vencimiento": "2027-02-01", "Cantidad": 260 }, { "Codigo_Cum": "23439-4", "Codigo_Barras": "7702184011348", "Lote": "F010948", "Fecha_Vencimiento": "2027-03-01", "Cantidad": 340 }, { "Codigo_Cum": "230417-6", "Codigo_Barras": "7703038065968", "Lote": 95659, "Fecha_Vencimiento": "2027-01-01", "Cantidad": 3 }, { "Codigo_Cum": "229538-5", "Codigo_Barras": 7707035511916, "Lote": 2401011, "Fecha_Vencimiento": "2026-03-01", "Cantidad": 120 }, { "Codigo_Cum": "227601-2", "Codigo_Barras": 7705959884277, "Lote": 977149, "Fecha_Vencimiento": "2028-03-01", "Cantidad": 60 }, { "Codigo_Cum": "226859-10", "Codigo_Barras": 7703763866885, "Lote": "F0325", "Fecha_Vencimiento": "2025-03-01", "Cantidad": 28 }, { "Codigo_Cum": "214251-8", "Codigo_Barras": 7703038066217, "Lote": 95517, "Fecha_Vencimiento": "2027-12-01", "Cantidad": 120 }, { "Codigo_Cum": "20162036-2", "Codigo_Barras": 7707288826690, "Lote": "E070457", "Fecha_Vencimiento": "2027-01-01", "Cantidad": 30 }, { "Codigo_Cum": "20160735-2", "Codigo_Barras": 7706127003599, "Lote": 961770, "Fecha_Vencimiento": "2026-12-01", "Cantidad": 30 }, { "Codigo_Cum": "20160734-2", "Codigo_Barras": 7706127003575, "Lote": 971208, "Fecha_Vencimiento": "2027-02-01", "Cantidad": 30 }, { "Codigo_Cum": "20160725-2", "Codigo_Barras": 7706127003759, "Lote": 911617, "Fecha_Vencimiento": "2026-04-01", "Cantidad": 30 }, { "Codigo_Cum": "20142721-1", "Codigo_Barras": 8903726237687, "Lote": "FD245824", "Fecha_Vencimiento": "2026-11-01", "Cantidad": 60 }, { "Codigo_Cum": "20140779-2", "Codigo_Barras": 7702635713364, "Lote": "OH9757", "Fecha_Vencimiento": "2026-08-01", "Cantidad": 460 }, { "Codigo_Cum": "20135125-2", "Codigo_Barras": 8903726232774, "Lote": "E250539", "Fecha_Vencimiento": "2026-12-01", "Cantidad": 20 }, { "Codigo_Cum": "20125451-6", "Codigo_Barras": 7707367050992, "Lote": "24L14", "Fecha_Vencimiento": "2026-10-01", "Cantidad": 80 }, { "Codigo_Cum": "20109639-5", "Codigo_Barras": 7703153034900, "Lote": 1551718, "Fecha_Vencimiento": "2027-02-01", "Cantidad": 30 }, { "Codigo_Cum": "20106196-2", "Codigo_Barras": 8903726204610, "Lote": "FD245410A", "Fecha_Vencimiento": "2027-11-01", "Cantidad": 30 }, { "Codigo_Cum": "20106115-1", "Codigo_Barras": 7703153033163, "Lote": 1548877, "Fecha_Vencimiento": "2027-01-01", "Cantidad": 30 }, { "Codigo_Cum": "20104297-3", "Codigo_Barras": 7709484810879, "Lote": "24F8523", "Fecha_Vencimiento": "2027-05-01", "Cantidad": 30 }, { "Codigo_Cum": "20101206-6", "Codigo_Barras": 4048846024091, "Lote": "G21755", "Fecha_Vencimiento": "2027-04-01", "Cantidad": 60 }, { "Codigo_Cum": "20096492-1", "Codigo_Barras": 7709930569436, "Lote": "C251689", "Fecha_Vencimiento": "2027-06-01", "Cantidad": 2 }, { "Codigo_Cum": "20088760-2", "Codigo_Barras": 8903726189955, "Lote": "FD245166", "Fecha_Vencimiento": "2027-10-01", "Cantidad": 120 }, { "Codigo_Cum": "20085383-15", "Codigo_Barras": 7702184011829, "Lote": "E110385", "Fecha_Vencimiento": "2026-12-01", "Cantidad": 640 }, { "Codigo_Cum": "20077272-7", "Codigo_Barras": 7707367051043, "Lote": "25C84", "Fecha_Vencimiento": "2027-04-01", "Cantidad": 240 }, { "Codigo_Cum": "20064394-2", "Codigo_Barras": 7612797511169, "Lote": "B9485K", "Fecha_Vencimiento": "2024-11-01", "Cantidad": 30 }, { "Codigo_Cum": "20057639-11", "Codigo_Barras": 7702184011225, "Lote": "F020403", "Fecha_Vencimiento": "2027-02-01", "Cantidad": 50 }, { "Codigo_Cum": "20054318-3", "Codigo_Barras": 7707274723095, "Lote": "E240502", "Fecha_Vencimiento": "2027-04-01", "Cantidad": 200 }, { "Codigo_Cum": "20048287-11", "Codigo_Barras": 7703153042691, "Lote": 1532203, "Fecha_Vencimiento": "2026-08-01", "Cantidad": 50 }, { "Codigo_Cum": "20044614-4", "Codigo_Barras": 7703038020189, "Lote": 96541, "Fecha_Vencimiento": "2027-02-01", "Cantidad": 60 }, { "Codigo_Cum": "20027702-31", "Codigo_Barras": 7702057712969, "Lote": "4H2308", "Fecha_Vencimiento": "2026-01-01", "Cantidad": 400 }, { "Codigo_Cum": "20026114-3", "Codigo_Barras": 7707019402278, "Lote": 401025, "Fecha_Vencimiento": "2027-01-01", "Cantidad": 30 }, { "Codigo_Cum": "20025656-6", "Codigo_Barras": 7707355055251, "Lote": 4540225, "Fecha_Vencimiento": "2027-03-01", "Cantidad": 40 }, { "Codigo_Cum": "20024307-9", "Codigo_Barras": 7703153024796, "Lote": 1555281, "Fecha_Vencimiento": "2027-03-01", "Cantidad": 50 }, { "Codigo_Cum": "20018308-6", "Codigo_Barras": 7707305850097, "Lote": 80541, "Fecha_Vencimiento": "2027-05-01", "Cantidad": 100 }, { "Codigo_Cum": "20011084-5", "Codigo_Barras": 7702605184460, "Lote": "E01488A", "Fecha_Vencimiento": "2026-07-01", "Cantidad": 210 }, { "Codigo_Cum": "20010390-1", "Codigo_Barras": 7707274723712, "Lote": 20240503, "Fecha_Vencimiento": "2027-05-01", "Cantidad": 28 }, { "Codigo_Cum": "20007896-10", "Codigo_Barras": 7730969301421, "Lote": "M10018", "Fecha_Vencimiento": "2027-08-01", "Cantidad": 30 }, { "Codigo_Cum": "20001515-3", "Codigo_Barras": 7707288824641, "Lote": "5M333", "Fecha_Vencimiento": "2027-03-01", "Cantidad": 50 }, { "Codigo_Cum": "20001113-13", "Codigo_Barras": 7707355057910, "Lote": 22751124, "Fecha_Vencimiento": "2026-05-01", "Cantidad": 120 }, { "Codigo_Cum": "19995986-2", "Codigo_Barras": 7709990555653, "Lote": "REWC", "Fecha_Vencimiento": "2025-09-01", "Cantidad": 28 }, { "Codigo_Cum": "19995299-7", "Codigo_Barras": 7702184014004, "Lote": "F010391", "Fecha_Vencimiento": "2027-01-01", "Cantidad": 320 }, { "Codigo_Cum": "19993894-1", "Codigo_Barras": 7702057077280, "Lote": "2M347", "Fecha_Vencimiento": "2025-09-01", "Cantidad": 2 }, { "Codigo_Cum": "19992435-7", "Codigo_Barras": 7702184876732, "Lote": "F031016", "Fecha_Vencimiento": "2029-04-01", "Cantidad": 890 }, { "Codigo_Cum": "19989832-5", "Codigo_Barras": 7703763999132, "Lote": "0171A", "Fecha_Vencimiento": "2027-03-01", "Cantidad": 60 }, { "Codigo_Cum": "19988571-4", "Codigo_Barras": 7703689087821, "Lote": 8181000, "Fecha_Vencimiento": "2029-01-01", "Cantidad": 693 }, { "Codigo_Cum": "19985876-2", "Codigo_Barras": 7702195208478, "Lote": "693B09", "Fecha_Vencimiento": "2026-07-01", "Cantidad": 20 }, { "Codigo_Cum": "19979471-6", "Codigo_Barras": 7707355058191, "Lote": 450125, "Fecha_Vencimiento": "2027-01-01", "Cantidad": 30 }, { "Codigo_Cum": "19978181-38", "Codigo_Barras": "7703546843003", "Lote": 2502431588, "Fecha_Vencimiento": "2028-02-01", "Cantidad": 240 }, { "Codigo_Cum": "19977789-3", "Codigo_Barras": 7612797691885, "Lote": "B9382P", "Fecha_Vencimiento": "2027-09-01", "Cantidad": 28 }, { "Codigo_Cum": "19977699-3", "Codigo_Barras": 7703712035485, "Lote": "G12415", "Fecha_Vencimiento": "2027-05-01", "Cantidad": 22 }, { "Codigo_Cum": "19976644-4", "Codigo_Barras": 7702605185184, "Lote": "F00108E", "Fecha_Vencimiento": "2027-01-01", "Cantidad": 5 }, { "Codigo_Cum": "19976470-3", "Codigo_Barras": 7705959015152, "Lote": "E02402A", "Fecha_Vencimiento": "2026-11-01", "Cantidad": 330 }, { "Codigo_Cum": "19974414-3", "Codigo_Barras": 7703763999217, "Lote": "F015", "Fecha_Vencimiento": "2027-01-01", "Cantidad": 50 }, { "Codigo_Cum": "19973788-1", "Codigo_Barras": 7703712032538, "Lote": "G01725", "Fecha_Vencimiento": "2027-03-01", "Cantidad": 2 }, { "Codigo_Cum": "19973772-5", "Codigo_Barras": 7707288820735, "Lote": "5M267", "Fecha_Vencimiento": "2029-03-01", "Cantidad": 50 }, { "Codigo_Cum": "19973061-5", "Codigo_Barras": 7705959884857, "Lote": 976353, "Fecha_Vencimiento": "2027-03-01", "Cantidad": 150 }, { "Codigo_Cum": "19965499-11", "Codigo_Barras": 7705959882129, "Lote": 975269, "Fecha_Vencimiento": "2027-03-01", "Cantidad": 1800 }, { "Codigo_Cum": "19965075-7", "Codigo_Barras": 7707355053097, "Lote": 18240824, "Fecha_Vencimiento": "2027-08-01", "Cantidad": 100 }, { "Codigo_Cum": "19963352-15", "Codigo_Barras": 7702184011362, "Lote": "E060092", "Fecha_Vencimiento": "2026-06-01", "Cantidad": 910 }, { "Codigo_Cum": "19956947-7", "Codigo_Barras": 7703038066125, "Lote": 96871, "Fecha_Vencimiento": "2027-03-01", "Cantidad": 260 }, { "Codigo_Cum": "19951877-2", "Codigo_Barras": 7703038066118, "Lote": 97166, "Fecha_Vencimiento": "2027-04-01", "Cantidad": 90 }, { "Codigo_Cum": "19951339-1", "Codigo_Barras": 7703432424071, "Lote": 2305514, "Fecha_Vencimiento": "2026-01-01", "Cantidad": 1 }, { "Codigo_Cum": "19950479-22", "Codigo_Barras": 3664798071528, "Lote": "SF395A", "Fecha_Vencimiento": "2026-10-01", "Cantidad": 9 }, { "Codigo_Cum": "19950177-3", "Codigo_Barras": 7705959885274, "Lote": 973810, "Fecha_Vencimiento": "2028-03-01", "Cantidad": 50 }, { "Codigo_Cum": "19947909-1", "Codigo_Barras": 7702195517525, "Lote": "625B02", "Fecha_Vencimiento": "2027-05-01", "Cantidad": 48 }, { "Codigo_Cum": "19943979-9", "Codigo_Barras": 7707355057989, "Lote": 3260225, "Fecha_Vencimiento": "2026-08-01", "Cantidad": 60 }, { "Codigo_Cum": "19942545-1", "Codigo_Barras": 7703153021900, "Lote": 1487416, "Fecha_Vencimiento": "2025-09-01", "Cantidad": 60 }, { "Codigo_Cum": "19940375-6", "Codigo_Barras": 7702184011157, "Lote": "F040808", "Fecha_Vencimiento": "2027-04-01", "Cantidad": 330 }, { "Codigo_Cum": "19939789-6", "Codigo_Barras": "7703763999170", "Lote": "F0525", "Fecha_Vencimiento": "2027-05-01", "Cantidad": 30 }, { "Codigo_Cum": "19936956-11", "Codigo_Barras": "7707035546161", "Lote": 2401028, "Fecha_Vencimiento": "2026-06-01", "Cantidad": 580 }, { "Codigo_Cum": "19936072-1", "Codigo_Barras": "7707019412109", "Lote": 400124, "Fecha_Vencimiento": "2027-03-01", "Cantidad": 20 }, { "Codigo_Cum": "19935345-11", "Codigo_Barras": "7702057963903", "Lote": "5B0857", "Fecha_Vencimiento": "2027-01-01", "Cantidad": 50 }, { "Codigo_Cum": "19935303-4", "Codigo_Barras": "7706569020567", "Lote": "24D049", "Fecha_Vencimiento": "2026-09-01", "Cantidad": 200 }, { "Codigo_Cum": "19934333-3", "Codigo_Barras": "7707355052229", "Lote": 12880624, "Fecha_Vencimiento": "2026-07-01", "Cantidad": 120 }, { "Codigo_Cum": "19932996-3", "Codigo_Barras": "7703546864381", "Lote": 2503004356, "Fecha_Vencimiento": "2027-06-01", "Cantidad": 150 }, { "Codigo_Cum": "19932573-3", "Codigo_Barras": "7702605185177", "Lote": "F00088A", "Fecha_Vencimiento": "2027-01-01", "Cantidad": 240 }, { "Codigo_Cum": "19931778-14", "Codigo_Barras": "7703546802307", "Lote": 2502000225, "Fecha_Vencimiento": "2028-01-01", "Cantidad": 90 }, { "Codigo_Cum": "19928485-9", "Codigo_Barras": "7703038065982", "Lote": 95622, "Fecha_Vencimiento": "2026-12-01", "Cantidad": 300 }, { "Codigo_Cum": "19927064-3", "Codigo_Barras": "7703038066231", "Lote": 96598, "Fecha_Vencimiento": "2027-03-01", "Cantidad": 150 }, { "Codigo_Cum": "19914312-21", "Codigo_Barras": "3664798063226", "Lote": "4F9980A", "Fecha_Vencimiento": "2027-09-01", "Cantidad": 70 }, { "Codigo_Cum": "19907710-13", "Codigo_Barras": "7707355056609", "Lote": 17320824, "Fecha_Vencimiento": "2026-08-01", "Cantidad": 50 }, { "Codigo_Cum": "19900906-16", "Codigo_Barras": "7702057712457", "Lote": "4K27618", "Fecha_Vencimiento": "2027-07-01", "Cantidad": 90 }, { "Codigo_Cum": "19900484-6", "Codigo_Barras": "7702195852992", "Lote": "710BB3", "Fecha_Vencimiento": "2026-11-01", "Cantidad": 300 }, { "Codigo_Cum": "1983837-5", "Codigo_Barras": "7703153004361", "Lote": 1539511, "Fecha_Vencimiento": "2026-11-01", "Cantidad": 80 }, { "Codigo_Cum": "1983837-5", "Codigo_Barras": "7703153004361", "Lote": 1503660, "Fecha_Vencimiento": "2026-01-01", "Cantidad": 70 }, { "Codigo_Cum": "1981505-17", "Codigo_Barras": "7702605185283", "Lote": "E02442A", "Fecha_Vencimiento": "2026-11-01", "Cantidad": 450 }, { "Codigo_Cum": "1980347-5", "Codigo_Barras": "7708986908930", "Lote": 1050224, "Fecha_Vencimiento": "2026-01-01", "Cantidad": 30 }, { "Codigo_Cum": "104739-2", "Codigo_Barras": "7703186621511", "Lote": "68926QA", "Fecha_Vencimiento": "2026-07-01", "Cantidad": 90 }, { "Codigo_Cum": "21013-6", "Codigo_Barras": 5000158071094, "Lote": "AEA916", "Fecha_Vencimiento": "2025-10-01", "Cantidad": 20 } ]';

    $prods = (array) json_decode($productos, true);

foreach($prods as $producto){


    $query = 'SELECT  PRD.Id_Producto, IFNULL(CONCAT(PRD.Nombre_Comercial," (",PRD.Principio_Activo," ",PRD.Presentacion," ",PRD.Concentracion,") ", PRD.Cantidad," ", PRD.Unidad_Medida),CONCAT(PRD.Nombre_Comercial," LAB-",PRD.Laboratorio_Comercial)) as Nombre,
    PRD.Laboratorio_Comercial,
    PRD.Laboratorio_Generico,
    PRD.Cantidad_Presentacion,
    PRD.Embalaje,
    IFNULL(PRD.Id_Categoria,0) as Id_Categoria,IFNULL((SELECT Nombre FROM Categoria WHERE Id_Categoria=PRD.Id_Categoria),"Sin Categoria") as Categoria,
    PRD.Imagen,
    PRD.Codigo_Cum,
    PRD.Codigo_Barras
    FROM Producto PRD
    LEFT JOIN Inventario_Nuevo I
    ON PRD.Id_Producto=I.Id_Producto 
    WHERE PRD.Codigo_Cum ='.$producto['Codigo_Cum']."  GROUP BY PRD.Id_Producto";

    $queryObj->SetQuery($query);
    $result = $queryObj->ExecuteQuery('simple');

}

var_dump($result);
exit(); 
?>