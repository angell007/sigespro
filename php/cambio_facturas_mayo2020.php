<?php
header('Access-Control-Allow-Origin: *');
header('Access-Control-Allow-Headers: Origin, Content-Type, X-Auth-Token');

require_once('../config/start.inc.php');
include_once('../class/class.lista.php');
include_once('../class/class.complex.php');
require_once('../class/class.configuracion.php');
include_once('../class/class.consulta.php');
require_once('../class/class.qr.php');  /* AGREGAR ESTA CLASE PARA GENERAR QR */
include_once('../class/class.contabilizar.php');

$configuracion = new Configuracion();
$contabilizacion = new Contabilizar(true);

/*
$query = 'SELECT * FROM `Factura` WHERE Id_Factura IN (157696,157695,157694,157693,157668,157667,157666,157665,157664,157663,157662,157661,157660,157659,157658,157657,157656,157655,157654,157653,157652,157651,157650,157649,157648,157637,157636,157635,157632,157631,157630,157629,157628,157627,157626,157625,157624,157623,157622,157621,157620,157619,157618,157617,157615,157614,157613,157612,157611,157610,157609,157608,157606,157605,157604,157603,157602,157601,157600,157599,157598,157597,157596,157595,157594,157593,157592,157590,157588,157586,157585,157584,157583,157582,157581,157580,157579,157578,157577,157576,157575,157574,157573,157572,157571,157570,157569,157568,157567,157566,157565,157564,157563,157562,157561,157560,157559,157558,157557,157556,157555,157554,157553,157552,157551,157550,157549,157548,157547,157546,157545,157544,157543,157542,157541,157540,157539,157538,157537,157536,157535,157534,157533,157532,157531,157530,157529,157528,157527,157526,157525,157524,157523,157522,157521,157520,157519,157518,157517,157516,157515,157514,157513,157512,157511,157510,157509,157508,157507,157506,157505,157504,157503,157502,157501,157500,157498,157497,157496,157495,157494,157493,157492,157491,157490,157489,157488,157487,157486,157485,157484,157483,157482,157481,157480,157479,157478,157477,157476,157475,157474,157473,157472,157471)
ORDER BY `Factura`.`Codigo`  ASC';
 
$oCon= new consulta();
$oCon->setTipo('Multiple');
$oCon->setQuery($query);
$facturas= $oCon->getData();
unset($oCon);


$viejas=["FENP15437","FENP15438","FENP15440","FENP15441","FENP15449","FENP15450","FENP15452","FENP15454","FENP15455","FENP15465","FENP15466","FENP15472","FENP15473","FENP15475","FENP15476","FENP15565","FENP15566","FENP15575","FENP15576","FENP15577","FENP15578","FENP15582","FENP15587","FENP15588","FENP15601","FENP15602","FENP15604","FENP15606","FENP15607","FENP15610","FENP15611","FENP15617","FENP15619","FENP15621","FENP15622","FENP15629","FENP15630","FENP15635","FENP15637","FENP15638","FENP15644","FENP15646","FENP15649","FENP15651","FENP15652","FENP15660","FENP15661","FENP15663","FENP15664","FENP15670","FENP15672","FENP15674","FENP15676","FENP15683","FENP15685","FENP15686","FENP15692","FENP15693","FENP15697","FENP15698","FENP15699","FENP15706","FENP15707","FENP15710","FENP15712","FENP15713","FENP15715","FENP15716","FENP15727","FENP15728","FENP15732","FENP15733","FENP15738","FENP15740","FENP15741","FENP15759","FENP15760","FENP15766","FENP15768","FENP15772","FENP15773","FENP15779","FENP15780","FENP15781","FENP15783","FENP15791","FENP15792","FENP15798","FENP15799","FENP15810","FENP15812","FENP15814","FENP15815","FENP15817","FENP15819","FENP15829","FENP15831","FENP15837","FENP15839","FENP15840","FENP15841","FENP15842","FENP15845","FENP15846","FENP15850","FENP15852","FENP15854","FENP15860","FENP15861","FENP15867","FENP15869","FENP15870","FENP15885","FENP15886","FENP15891","FENP15892","FENP15896","FENP15897","FENP15913","FENP15914","FENP15922","FENP15924","FENP15925","FENP15936","FENP15937","FENP15957","FENP15959","FENP15960","FENP15964","FENP15965","FENP15968","FENP15969","FENP15988","FENP15989","FENP16002","FENP16003","FENP16010","FENP16011","FENP16038","FENP16039","FENP16041","FENP16042","FENP16063","FENP16064","FENP16067","FENP16069","FENP16070","FENP16077","FENP16078","FENP16081","FENP16083","FENP16084","FENP16091","FENP16092","FENP16095","FENP16096","FENP16098","FENP16099","FENP16100","FENP16102","FENP16112","FENP16114","FENP16115","FENP16120","FENP16121","FENP16122","FENP16123","FENP16144","FENP16145","FENP16148","FENP16150","FENP16151","FENP16161","FENP16163","FENP16164","FENP16167","FENP16169","FENP16176","FENP16178","FENP16179","FENP19240","FENP21540","FENP21593"];

$i=-1;
foreach($facturas as $fact){ $i++;
	
	$query = 'SELECT Codigo,Fecha_Documento FROM Factura WHERE Codigo < "'.$viejas[$i].'" AND Id_Resolucion = 21 ORDER BY Fecha_Documento DESC LIMIT 1';
	$oCon= new consulta();
	$oCon->setQuery($query);
	$fecha= $oCon->getData();
	unset($oCon);
		
	$oItem = new complex("Factura","Id_Factura",$fact["Id_Factura"]);
	$oItem->Codigo = $viejas[$i];
	$oItem->Fecha_Documento = $fecha["Fecha_Documento"];
	$oItem->save();
	unset($oItem);
		
}
*/


$query = 'SELECT * FROM `Factura` WHERE REPLACE(Codigo, "FENP", "") > 24100 AND Id_Resolucion = 21  
ORDER BY `Factura`.`Codigo`  ASC';
 
$oCon= new consulta();
$oCon->setTipo('Multiple');
$oCon->setQuery($query);
$facturas= $oCon->getData();
unset($oCon);

$i=24100;

foreach($facturas as $fact){ $i++;
	$oItem = new complex("Factura","Id_Factura",$fact["Id_Factura"]);
	$oItem->Codigo = "FENP".$i;
	//$oItem->save();
	unset($oItem);
	echo $fact["Codigo"]." - FENP".$i."<br>";
	

}


?>